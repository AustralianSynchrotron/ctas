<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ctas: /home/antonmx/work/projects/ctascmake/src/common/common.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ctas&#160;<span id="projectnumber">0.5.2</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_3d54202a3b8ee27d21a2088f81ee8e9a.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_2f355405f57d8b2bf2067fc213a1a45e.html">common</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>common.cpp</h1>  </div>
</div>
<div class="contents">
<a href="common_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001  <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *   Copyright (C) 2007 by Anton Maksimenko                                   *</span>
<a name="l00003"></a>00003 <span class="comment"> *   antonmx@post.kek.jp                                                      *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                            *</span>
<a name="l00005"></a>00005 <span class="comment"> *   This program is free software; you can redistribute it and/or modify     *</span>
<a name="l00006"></a>00006 <span class="comment"> *   it under the terms of the GNU General Public License as published by     *</span>
<a name="l00007"></a>00007 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or        *</span>
<a name="l00008"></a>00008 <span class="comment"> *   (at your option) any later version.                                      *</span>
<a name="l00009"></a>00009 <span class="comment"> *                                                                            *</span>
<a name="l00010"></a>00010 <span class="comment"> *   This program is distributed in the hope that it will be useful,          *</span>
<a name="l00011"></a>00011 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of           *</span>
<a name="l00012"></a>00012 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            *</span>
<a name="l00013"></a>00013 <span class="comment"> *   GNU General Public License for more details.                             *</span>
<a name="l00014"></a>00014 <span class="comment"> *                                                                            *</span>
<a name="l00015"></a>00015 <span class="comment"> *   You should have received a copy of the GNU General Public License        *</span>
<a name="l00016"></a>00016 <span class="comment"> *   along with this program; if not, write to the                            *</span>
<a name="l00017"></a>00017 <span class="comment"> *   Free Software Foundation, Inc.,                                          *</span>
<a name="l00018"></a>00018 <span class="comment"> *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.                *</span>
<a name="l00019"></a>00019 <span class="comment"> ******************************************************************************/</span>
<a name="l00020"></a>00020 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#  define _CRT_SECURE_NO_WARNINGS 1 // needed to avoid wornings in MS VC++</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#include&lt;algorithm&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;string.h&gt;</span> <span class="comment">// for memcpy</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="common_8h.html" title="Header file with common functions and types.">common.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">using namespace </span>std;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00050"></a><a class="code" href="classCtasErr.html#a0ce2e9de69c0de8528389267c5e139be">00050</a> <a class="code" href="classCtasErr.html#a0ce2e9de69c0de8528389267c5e139be" title="Constructor.">CtasErr::CtasErr</a>(<a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654" title="Error severity.">ErrTp</a> _terr, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; mod, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; msg){
<a name="l00051"></a>00051   terr = _terr;
<a name="l00052"></a>00052   module = mod;
<a name="l00053"></a>00053   message = msg;
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00057"></a>00057 <span class="keywordtype">void</span>
<a name="l00058"></a><a class="code" href="classCtasErr.html#a031589545d4a5c4c2d36913ce1b553c6">00058</a> <a class="code" href="classCtasErr.html#a031589545d4a5c4c2d36913ce1b553c6" title="Reports the error to the ctderr.">CtasErr::report</a>()<span class="keyword"> const </span>{
<a name="l00059"></a>00059   <span class="keywordflow">switch</span> ( terr ) {
<a name="l00060"></a>00060   <span class="keywordflow">case</span> WARN:
<a name="l00061"></a>00061     cerr &lt;&lt; <span class="stringliteral">&quot;WARNING!&quot;</span>;
<a name="l00062"></a>00062     <span class="keywordflow">break</span>;
<a name="l00063"></a>00063   <span class="keywordflow">case</span> ERR:
<a name="l00064"></a>00064     cerr &lt;&lt; <span class="stringliteral">&quot;ERROR!&quot;</span>;
<a name="l00065"></a>00065     <span class="keywordflow">break</span>;
<a name="l00066"></a>00066   <span class="keywordflow">case</span> FATAL:
<a name="l00067"></a>00067     cerr &lt;&lt; <span class="stringliteral">&quot;FATAL ERROR!&quot;</span>;
<a name="l00068"></a>00068     <span class="keywordflow">break</span>;
<a name="l00069"></a>00069   }
<a name="l00070"></a>00070   cerr &lt;&lt; <span class="stringliteral">&quot; In module \&#39;&quot;</span> &lt;&lt; module &lt;&lt; <span class="stringliteral">&quot;\&#39;. &quot;</span> &lt;&lt; message &lt;&lt; endl;
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654" title="Error severity.">CtasErr::ErrTp</a>
<a name="l00075"></a><a class="code" href="classCtasErr.html#a29e66cdf8ef4dfe224ee287c6cf72d13">00075</a> <a class="code" href="classCtasErr.html#a29e66cdf8ef4dfe224ee287c6cf72d13" title="Returns error type.">CtasErr::type</a>()<span class="keyword"> const </span>{
<a name="l00076"></a>00076   <span class="keywordflow">return</span> terr;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keywordtype">void</span>
<a name="l00081"></a><a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157">00081</a> <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; mod, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; msg){
<a name="l00082"></a>00082   <a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err(<a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a2730082bed1adb75fea32d2392df3f2b" title="Error.">CtasErr::ERR</a>, mod, msg);
<a name="l00083"></a>00083   err.<a class="code" href="classCtasErr.html#a031589545d4a5c4c2d36913ce1b553c6" title="Reports the error to the ctderr.">report</a>();
<a name="l00084"></a>00084   <span class="keywordflow">throw</span> err;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="keywordtype">void</span>
<a name="l00088"></a><a class="code" href="group__Error.html#gacb8a74cf255f5788357a30ce8b4f80db">00088</a> <a class="code" href="group__Error.html#gacb8a74cf255f5788357a30ce8b4f80db" title="Reports and throws the bug.">throw_bug</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; mod){
<a name="l00089"></a>00089   <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(mod, <span class="stringliteral">&quot;Must never happen. This is the bug, please report to developers.&quot;</span>);
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a>
<a name="l00093"></a><a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4">00093</a> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; mod, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; msg){
<a name="l00094"></a>00094   <a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err(<a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a79e18c2e2af3c0b01de4d1b303877697" title="Warning.">CtasErr::WARN</a>, mod, msg);
<a name="l00095"></a>00095   err.<a class="code" href="classCtasErr.html#a031589545d4a5c4c2d36913ce1b553c6" title="Reports the error to the ctderr.">report</a>();
<a name="l00096"></a>00096   <span class="keywordflow">return</span> err;
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="keywordtype">void</span>
<a name="l00100"></a><a class="code" href="group__Error.html#ga9ddf0cafadd98ea5e8558558b8d6dfb5">00100</a> <a class="code" href="group__Error.html#ga9ddf0cafadd98ea5e8558558b8d6dfb5" title="Constructs the error, reports and then exits.">exit_on_error</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; mod, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; msg){
<a name="l00101"></a>00101   <a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err(<a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a1f266c6ae424c0012c7507c416d936f1" title="Fatal error.">CtasErr::FATAL</a>, mod, msg);
<a name="l00102"></a>00102   err.<a class="code" href="classCtasErr.html#a031589545d4a5c4c2d36913ce1b553c6" title="Reports the error to the ctderr.">report</a>();
<a name="l00103"></a>00103   cerr &lt;&lt; <span class="stringliteral">&quot;!!! EXITING ON ERROR !!!&quot;</span> &lt;&lt; endl;
<a name="l00104"></a>00104   exit(1);
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="classPath.html#aa881be005b73647137228e3db0dacdb6" title="Directory separator.">Path::DIRSEPARATOR</a> = <span class="stringliteral">&quot;\\&quot;</span>;
<a name="l00111"></a>00111 <span class="preprocessor">#else</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="classPath.html#aa881be005b73647137228e3db0dacdb6" title="Directory separator.">Path::DIRSEPARATOR</a> = <span class="stringliteral">&quot;/&quot;</span>;
<a name="l00113"></a>00113 <span class="preprocessor">#endif</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a>00115 
<a name="l00120"></a>00120 <span class="keywordtype">void</span>
<a name="l00121"></a><a class="code" href="classPath.html#a2a1232aebba532d6b2f728dd2d478a76">00121</a> <a class="code" href="classPath.html#a2a1232aebba532d6b2f728dd2d478a76" title="throws error in extracting an element.">Path::throw_unextracted</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; element)<span class="keyword"> const </span>{
<a name="l00122"></a>00122   <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a> 
<a name="l00123"></a>00123         (<span class="stringliteral">&quot;class Path&quot;</span>,
<a name="l00124"></a>00124          <span class="stringliteral">&quot;Could not extract &quot;</span> + element + <span class="stringliteral">&quot; from path \&quot;&quot;</span> + *<span class="keyword">this</span> + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="keywordtype">string</span>
<a name="l00128"></a><a class="code" href="classPath.html#a72f40a492c7e64723302c589a8f1f334">00128</a> <a class="code" href="classPath.html#a72f40a492c7e64723302c589a8f1f334" title="Extracts drive letter (has sense on MS WIN only).">Path::drive</a> ()<span class="keyword"> const </span>{
<a name="l00129"></a>00129 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>  <span class="keywordtype">char</span> _drive[FILENAME_MAX];
<a name="l00131"></a>00131   <span class="keywordflow">if</span> ( _splitpath_s( c_str(), _drive, FILENAME_MAX, 0,0,0,0,0,0 ) )
<a name="l00132"></a>00132         throw_unextracted(<span class="stringliteral">&quot;drive&quot;</span>);
<a name="l00133"></a>00133   <span class="keywordflow">return</span> _drive;
<a name="l00134"></a>00134 <span class="preprocessor">#else</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00136"></a>00136 <span class="preprocessor">#endif</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>}
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="keywordtype">string</span>
<a name="l00140"></a><a class="code" href="classPath.html#abf4affad000c6baa4fe2f573d0ce395f">00140</a> <a class="code" href="classPath.html#abf4affad000c6baa4fe2f573d0ce395f" title="Extracts directory.">Path::dir</a> ()<span class="keyword"> const </span>{
<a name="l00141"></a>00141 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>  <span class="keywordtype">char</span> _dir[FILENAME_MAX];
<a name="l00143"></a>00143   <span class="keywordflow">if</span> ( _splitpath_s( c_str(),0,0,_dir,FILENAME_MAX,0,0,0,0 ) )
<a name="l00144"></a>00144         throw_unextracted(<span class="stringliteral">&quot;directory&quot;</span>);
<a name="l00145"></a>00145   <span class="keywordflow">return</span> drive() + _dir;
<a name="l00146"></a>00146 <span class="preprocessor">#else</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>  string::size_type idx=this-&gt;rfind(<span class="stringliteral">&quot;/&quot;</span>);
<a name="l00148"></a>00148   <span class="keywordflow">return</span>  idx == string::npos  ?  string(<span class="stringliteral">&quot;&quot;</span>)  :  string(*<span class="keyword">this</span>, 0, idx+1);
<a name="l00149"></a>00149 <span class="preprocessor">#endif</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>}
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="keywordtype">string</span>
<a name="l00153"></a><a class="code" href="classPath.html#aff986368d9ba09541e2823e452bf4ae2">00153</a> <a class="code" href="classPath.html#aff986368d9ba09541e2823e452bf4ae2" title="Extracts file name.">Path::name</a> ()<span class="keyword"> const </span>{
<a name="l00154"></a>00154 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>  <span class="keywordflow">return</span> title() + extension();
<a name="l00156"></a>00156 <span class="preprocessor">#else</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>  <span class="keywordtype">size_t</span> found = this-&gt;rfind(<span class="charliteral">&#39;/&#39;</span>);
<a name="l00158"></a>00158   <span class="keywordflow">if</span> (found==string::npos)
<a name="l00159"></a>00159     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00160"></a>00160   <span class="keywordflow">else</span>
<a name="l00161"></a>00161     <span class="keywordflow">return</span> this-&gt;substr(found+1);
<a name="l00162"></a>00162 <span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>};
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="keywordtype">string</span>
<a name="l00167"></a><a class="code" href="classPath.html#ac93ac36524119932f248f70329213d31">00167</a> <a class="code" href="classPath.html#ac93ac36524119932f248f70329213d31" title="Extracts title (filename without the extension).">Path::title</a> ()<span class="keyword"> const </span>{
<a name="l00168"></a>00168 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>  <span class="keywordtype">char</span> _title[FILENAME_MAX];
<a name="l00170"></a>00170   <span class="keywordflow">if</span> ( _splitpath_s( c_str(), 0,0,0,0, _title, FILENAME_MAX, 0,0 ) )
<a name="l00171"></a>00171         throw_unextracted(<span class="stringliteral">&quot;title&quot;</span>);
<a name="l00172"></a>00172   <span class="keywordflow">return</span> _title;
<a name="l00173"></a>00173 <span class="preprocessor">#else</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>  string::size_type idx = name().rfind(<span class="stringliteral">&quot;.&quot;</span>);
<a name="l00175"></a>00175   <span class="keywordflow">if</span> (idx==string::npos || idx == 0 )
<a name="l00176"></a>00176         <span class="keywordflow">return</span> name();
<a name="l00177"></a>00177   <span class="keywordflow">else</span>
<a name="l00178"></a>00178         <span class="keywordflow">return</span> name().substr(0, idx);
<a name="l00179"></a>00179 <span class="preprocessor">#endif</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>}
<a name="l00181"></a>00181  
<a name="l00182"></a>00182 <span class="keywordtype">string</span>
<a name="l00183"></a><a class="code" href="classPath.html#a564754a82c5c20d189409ba44ceea86b">00183</a> <a class="code" href="classPath.html#a564754a82c5c20d189409ba44ceea86b" title="Extracts title with the preceding full path.">Path::dtitle</a> ()<span class="keyword"> const </span>{
<a name="l00184"></a>00184   <span class="keywordflow">return</span> dir() + title();
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="keywordtype">string</span>
<a name="l00189"></a><a class="code" href="classPath.html#a7f2657c21893cc8158c6deab5edcf2d1">00189</a> <a class="code" href="classPath.html#a7f2657c21893cc8158c6deab5edcf2d1" title="Extracts the extension.">Path::extension</a> ()<span class="keyword"> const </span>{
<a name="l00190"></a>00190 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>  <span class="keywordtype">char</span> _ext[FILENAME_MAX];
<a name="l00192"></a>00192   <span class="keywordflow">if</span> ( _splitpath_s( c_str(), 0,0,0,0,0,0, _ext, FILENAME_MAX ) )
<a name="l00193"></a>00193         throw_unextracted(<span class="stringliteral">&quot;extension&quot;</span>);
<a name="l00194"></a>00194   <span class="keywordflow">return</span> _ext;
<a name="l00195"></a>00195 <span class="preprocessor">#else</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>  string::size_type
<a name="l00197"></a>00197         dotidx = this-&gt;rfind(<span class="stringliteral">&quot;.&quot;</span>),
<a name="l00198"></a>00198         diridx = this-&gt;rfind(<span class="stringliteral">&quot;/&quot;</span>);
<a name="l00199"></a>00199   <span class="keywordflow">if</span> ( dotidx != string::npos &amp;&amp; ( diridx == string::npos || diridx+1 &lt; dotidx ) )
<a name="l00200"></a>00200         <span class="keywordflow">return</span> this-&gt;substr(dotidx);
<a name="l00201"></a>00201   <span class="keywordflow">else</span>
<a name="l00202"></a>00202         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00203"></a>00203 <span class="preprocessor">#endif</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>}
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="keywordtype">bool</span>
<a name="l00209"></a><a class="code" href="classPath.html#ab601d3934286745a61b197e4601c1e32">00209</a> <a class="code" href="classPath.html#ab601d3934286745a61b197e4601c1e32" title="Tells if the path definitely represents the a directory.">Path::isdir</a>()<span class="keyword"> const </span>{
<a name="l00210"></a>00210   <span class="keywordflow">return</span> ! empty() &amp;&amp; name().empty();
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp;
<a name="l00214"></a><a class="code" href="classPath.html#aa209169977f4d0866658e2d340dcc6af">00214</a> <a class="code" href="classPath.html#aa209169977f4d0866658e2d340dcc6af" title="Makes the path to be the directory (adds DIRSEPARATOR).">Path::bedir</a>() {
<a name="l00215"></a>00215   <span class="keywordflow">if</span> ( ! empty() &amp;&amp; ! isdir() )
<a name="l00216"></a>00216         *<span class="keyword">this</span> += DIRSEPARATOR;
<a name="l00217"></a>00217   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="keywordtype">bool</span>
<a name="l00222"></a><a class="code" href="classPath.html#a19c63487e42238c70502464542553c67">00222</a> <a class="code" href="classPath.html#a19c63487e42238c70502464542553c67" title="Tells if the path is absolute.">Path::isabsolute</a>()<span class="keyword"> const </span>{
<a name="l00223"></a>00223 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>  <span class="keywordflow">return</span> ! drive().empty();
<a name="l00225"></a>00225 <span class="preprocessor">#else</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>  <span class="keywordflow">return</span> ! empty() &amp;&amp; (*this)[0] == <span class="charliteral">&#39;/&#39;</span>;
<a name="l00227"></a>00227 <span class="preprocessor">#endif  </span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>}
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a>
<a name="l00232"></a><a class="code" href="group__Types.html#gad3c78ff20aae27d0ada01a8ec7c33512">00232</a> <a class="code" href="group__Types.html#gad3c78ff20aae27d0ada01a8ec7c33512" title="Upgrades the filename with an addition.">upgrade</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; path, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; addthis) {
<a name="l00233"></a>00233   <span class="keywordflow">return</span> path.<a class="code" href="classPath.html#abf4affad000c6baa4fe2f573d0ce395f" title="Extracts directory.">dir</a>() + <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a>(addthis) + path.<a class="code" href="classPath.html#aff986368d9ba09541e2823e452bf4ae2" title="Extracts file name.">name</a>();
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a>
<a name="l00238"></a><a class="code" href="group__Types.html#ga4de1e55e650dc8f387cbccfcf26fe51f">00238</a> <a class="code" href="group__Types.html#ga4de1e55e650dc8f387cbccfcf26fe51f" title="Adds the path to the filename.">cdpath</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; dir, <span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; file){
<a name="l00239"></a>00239   <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> ddir = dir;
<a name="l00240"></a>00240   ddir.<a class="code" href="classPath.html#aa209169977f4d0866658e2d340dcc6af" title="Makes the path to be the directory (adds DIRSEPARATOR).">bedir</a>();
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="keywordflow">if</span> ( file.empty() )
<a name="l00243"></a>00243         <span class="keywordflow">return</span> ddir;
<a name="l00244"></a>00244   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( file.<a class="code" href="classPath.html#a19c63487e42238c70502464542553c67" title="Tells if the path is absolute.">isabsolute</a>() || ddir.empty() )
<a name="l00245"></a>00245         <span class="keywordflow">return</span> file;
<a name="l00246"></a>00246   <span class="keywordflow">else</span>
<a name="l00247"></a>00247       <span class="comment">// Windows version is likely to fail here. See Path operator+.</span>
<a name="l00248"></a>00248         <span class="keywordflow">return</span> ddir + file;
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="keywordtype">string</span>
<a name="l00253"></a><a class="code" href="group__Types.html#ga8fd2857cd3b4a7006c31dd06af0f3e78">00253</a> <a class="code" href="group__Types.html#ga8fd2857cd3b4a7006c31dd06af0f3e78" title="Prints type name. To be used in the CLI parsing via &amp;quot;poptmx&amp;quot; library.">type_desc</a> (<a class="code" href="classPath.html" title="Path in the directory structure.">Path</a>*) {
<a name="l00254"></a>00254   <span class="keywordflow">return</span> <span class="stringliteral">&quot;PATH&quot;</span>;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="keywordtype">bool</span>
<a name="l00258"></a><a class="code" href="group__Types.html#ga4e0eee1b7fdba3969d084be434981931">00258</a> <a class="code" href="group__Types.html#ga4e0eee1b7fdba3969d084be434981931" title="Converts the string &amp;quot;in&amp;quot; into the Path _val. To be used in the CLI parsing via &amp;quot;poptmx...">_conversion</a> (<a class="code" href="classPath.html" title="Path in the directory structure.">Path</a>* _val, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; in) {
<a name="l00259"></a>00259   *_val = <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a>(in);
<a name="l00260"></a>00260   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="keyword">const</span> <span class="keywordtype">string</span>
<a name="l00275"></a>00275 <a class="code" href="classContrast.html#ad080deac5626be04e6f0b0148564cd56" title="Module name.">Contrast::modname</a>=<span class="stringliteral">&quot;contrast&quot;</span>;
<a name="l00276"></a>00276 
<a name="l00280"></a><a class="code" href="classContrast.html#a2557eaac83e602a33b25cd9a6eaf991d">00280</a> <a class="code" href="classContrast.html#a2557eaac83e602a33b25cd9a6eaf991d" title="Constructor from contrast type.">Contrast::Contrast</a>(<a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72f" title="Known contrast types.">Cntype</a> _cn)
<a name="l00281"></a>00281   : _contrast(_cn) {}
<a name="l00282"></a>00282 
<a name="l00286"></a><a class="code" href="classContrast.html#a4e55b92f5b8edb836df5eb8dca5a19e2">00286</a> <a class="code" href="classContrast.html#a2557eaac83e602a33b25cd9a6eaf991d" title="Constructor from contrast type.">Contrast::Contrast</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; _name) {
<a name="l00287"></a>00287   <span class="keywordtype">string</span> <a class="code" href="classContrast.html#a759690bfe7dbf3ef5b416ceb6767183f" title="Name of the contrast type.">name</a> = <a class="code" href="group__CommonFunctions.html#gafb844ea13cbc3a3596026448ace0a808" title="Convert string to upper case.">upper</a>(_name);
<a name="l00288"></a>00288   <span class="keywordflow">if</span> ( name == <span class="stringliteral">&quot;A&quot;</span> || name == <span class="stringliteral">&quot;ABS&quot;</span> || name == <span class="stringliteral">&quot;ABSORPTION&quot;</span> ) <a class="code" href="classContrast.html#ac333f4983aae5b900d5cc57f4ff51453" title="Type of the contrast.">_contrast</a> = <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72fa81734a45711f288f6c5e7f54bcbbffbb" title="Absorption.">ABS</a>;
<a name="l00289"></a>00289   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( name == <span class="stringliteral">&quot;R&quot;</span> || name == <span class="stringliteral">&quot;REF&quot;</span> || name == <span class="stringliteral">&quot;REFRACTION&quot;</span> ) <a class="code" href="classContrast.html#ac333f4983aae5b900d5cc57f4ff51453" title="Type of the contrast.">_contrast</a> = <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72faf34254288d1ad4c4847bf6dec827b603" title="Refraction.">REF</a>;
<a name="l00290"></a>00290   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( name == <span class="stringliteral">&quot;P&quot;</span> || name == <span class="stringliteral">&quot;PHS&quot;</span> || name == <span class="stringliteral">&quot;PHASE&quot;</span> ) <a class="code" href="classContrast.html#ac333f4983aae5b900d5cc57f4ff51453" title="Type of the contrast.">_contrast</a> = <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72fa1b525c7d8fa77ecc38d32957bdbb2a77" title="Phase.">PHS</a>;
<a name="l00291"></a>00291   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( name == <span class="stringliteral">&quot;F&quot;</span> || name == <span class="stringliteral">&quot;FLT&quot;</span> || name == <span class="stringliteral">&quot;FILTERED&quot;</span> ) <a class="code" href="classContrast.html#ac333f4983aae5b900d5cc57f4ff51453" title="Type of the contrast.">_contrast</a> = <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72fa1d6ff103864450064c6bba77f807fa50" title="Pre-filtered: ready for backprojection, no filtering needed.">FLT</a>;
<a name="l00292"></a>00292   <span class="keywordflow">else</span> <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;contrast type&quot;</span>, <span class="stringliteral">&quot;The string \&quot;&quot;</span>+ _name +<span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00293"></a>00293                                    <span class="stringliteral">&quot; does not describe any known contrast.&quot;</span>);
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00300"></a>00300 <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72f" title="Known contrast types.">Contrast::Cntype</a>
<a name="l00301"></a><a class="code" href="classContrast.html#a3dd81835c0b2b465c9ca1f70cf531808">00301</a> <a class="code" href="classContrast.html#a3dd81835c0b2b465c9ca1f70cf531808" title="Contrast type.">Contrast::contrast</a>()<span class="keyword"> const </span>{
<a name="l00302"></a>00302   <span class="keywordflow">return</span> <a class="code" href="classContrast.html#ac333f4983aae5b900d5cc57f4ff51453" title="Type of the contrast.">_contrast</a>;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00310"></a>00310 <span class="keywordtype">string</span>
<a name="l00311"></a><a class="code" href="classContrast.html#a759690bfe7dbf3ef5b416ceb6767183f">00311</a> <a class="code" href="classContrast.html#a759690bfe7dbf3ef5b416ceb6767183f" title="Name of the contrast type.">Contrast::name</a>()<span class="keyword"> const </span>{
<a name="l00312"></a>00312   <span class="keywordflow">switch</span> (<a class="code" href="classContrast.html#ac333f4983aae5b900d5cc57f4ff51453" title="Type of the contrast.">_contrast</a>) {
<a name="l00313"></a>00313   <span class="keywordflow">case</span> <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72faf34254288d1ad4c4847bf6dec827b603" title="Refraction.">REF</a>:     <span class="keywordflow">return</span> <span class="stringliteral">&quot;REFRACTION&quot;</span>;
<a name="l00314"></a>00314   <span class="keywordflow">case</span> <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72fa81734a45711f288f6c5e7f54bcbbffbb" title="Absorption.">ABS</a>:     <span class="keywordflow">return</span> <span class="stringliteral">&quot;ABSORPTION&quot;</span>;
<a name="l00315"></a>00315   <span class="keywordflow">case</span> <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72fa1b525c7d8fa77ecc38d32957bdbb2a77" title="Phase.">PHS</a>:     <span class="keywordflow">return</span> <span class="stringliteral">&quot;PHASE&quot;</span>;
<a name="l00316"></a>00316   <span class="keywordflow">case</span> <a class="code" href="classContrast.html#a99b7c9b3f4f10b92a6db24002adac72fa1d6ff103864450064c6bba77f807fa50" title="Pre-filtered: ready for backprojection, no filtering needed.">FLT</a>:     <span class="keywordflow">return</span> <span class="stringliteral">&quot;FILTERED&quot;</span>;
<a name="l00317"></a>00317   <span class="keywordflow">default</span> :
<a name="l00318"></a>00318           <a class="code" href="group__Error.html#gacb8a74cf255f5788357a30ce8b4f80db" title="Reports and throws the bug.">throw_bug</a>(__FUNCTION__);
<a name="l00319"></a>00319           <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00320"></a>00320   }
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="keyword">const</span> std::string <a class="code" href="classContrast.html#add7b49ae6e98cb290c7d1df3eefc6330" title="Description of the option giving the contrast type.">Contrast::Desc</a> =
<a name="l00324"></a>00324             <span class="stringliteral">&quot;Must be one of the following strings (case insensitive):\n&quot;</span>
<a name="l00325"></a>00325             <span class="stringliteral">&quot;A, ABS, ABSORPTION - for the absorption contrast\n&quot;</span>
<a name="l00326"></a>00326             <span class="stringliteral">&quot;R, REF, REFRACTION - for the refraction contrast\n&quot;</span>
<a name="l00327"></a>00327             <span class="stringliteral">&quot;P, PHS, PHASE      - for the phase contrast\n&quot;</span>
<a name="l00328"></a>00328             <span class="stringliteral">&quot;F, FLT, FILTERED   - for the pre-filtered contrast&quot;</span>;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="keywordtype">bool</span>
<a name="l00333"></a><a class="code" href="group__Types.html#ga9e64a10e0cc4fff11763fa59660ec038">00333</a> <a class="code" href="group__Types.html#ga9e64a10e0cc4fff11763fa59660ec038" title="Compare contrasts.">operator==</a>(<span class="keyword">const</span> <a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a> &amp; a, <span class="keyword">const</span> <a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a> &amp; b){
<a name="l00334"></a>00334   <span class="keywordflow">return</span> a.<a class="code" href="classContrast.html#a3dd81835c0b2b465c9ca1f70cf531808" title="Contrast type.">contrast</a>() == b.<a class="code" href="classContrast.html#a3dd81835c0b2b465c9ca1f70cf531808" title="Contrast type.">contrast</a>();
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keywordtype">bool</span>
<a name="l00339"></a><a class="code" href="group__Types.html#gaebd775321a5c08374eaed2b227b83552">00339</a> <a class="code" href="group__Types.html#gaebd775321a5c08374eaed2b227b83552" title="Compare contrasts.">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a> &amp; a, <span class="keyword">const</span> <a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a> &amp; b){
<a name="l00340"></a>00340   <span class="keywordflow">return</span> a.<a class="code" href="classContrast.html#a3dd81835c0b2b465c9ca1f70cf531808" title="Contrast type.">contrast</a>() != b.<a class="code" href="classContrast.html#a3dd81835c0b2b465c9ca1f70cf531808" title="Contrast type.">contrast</a>();
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="keywordtype">string</span>
<a name="l00344"></a><a class="code" href="group__Types.html#ga53ad0d300f418a34031d5efe90bc135f">00344</a> <a class="code" href="group__Types.html#ga8fd2857cd3b4a7006c31dd06af0f3e78" title="Prints type name. To be used in the CLI parsing via &amp;quot;poptmx&amp;quot; library.">type_desc</a> (<a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a>*){
<a name="l00345"></a>00345   <span class="keywordflow">return</span> <span class="stringliteral">&quot;STRING&quot;</span>;
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="keywordtype">bool</span>
<a name="l00349"></a><a class="code" href="group__Types.html#gaae619afb669156b36cccf8fff2fef8e7">00349</a> <a class="code" href="group__Types.html#ga4e0eee1b7fdba3969d084be434981931" title="Converts the string &amp;quot;in&amp;quot; into the Path _val. To be used in the CLI parsing via &amp;quot;poptmx...">_conversion</a> (<a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a>* _val, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; in) {
<a name="l00350"></a>00350   *_val=<a class="code" href="classContrast.html" title="Type of the input contrast.">Contrast</a>(in);
<a name="l00351"></a>00351   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 
<a name="l00367"></a><a class="code" href="group__CommonFunctions.html#ga74d5dcc9d3050f0a8230fc00606fa9a3">00367</a> <span class="keyword">const</span> std::string <a class="code" href="group__CommonFunctions.html#ga74d5dcc9d3050f0a8230fc00606fa9a3" title="Description of the -i, --int option used in many modules.">IntOptionDesc</a> =
<a name="l00368"></a>00368   <span class="stringliteral">&quot;If this option is not set, the output format defaults to the&quot;</span>
<a name="l00369"></a>00369   <span class="stringliteral">&quot; 32-bit float-point TIFF (regardless of the extension).&quot;</span>
<a name="l00370"></a>00370   <span class="stringliteral">&quot; If it is set, the image format is derived from the output&quot;</span>
<a name="l00371"></a>00371   <span class="stringliteral">&quot; file extension (TIFF if the extension does not correspond&quot;</span>
<a name="l00372"></a>00372   <span class="stringliteral">&quot; to any format).&quot;</span>;
<a name="l00373"></a>00373 
<a name="l00374"></a><a class="code" href="group__CommonFunctions.html#ga5e3460d8e3eb92dd0ed0e19b21e183ce">00374</a> <span class="keyword">const</span> std::string <a class="code" href="group__CommonFunctions.html#ga5e3460d8e3eb92dd0ed0e19b21e183ce" title="The note added to many options.">NeedForQuant</a> =
<a name="l00375"></a>00375   <span class="stringliteral">&quot;The value is required only to produce the physically correct output.&quot;</span>
<a name="l00376"></a>00376   <span class="stringliteral">&quot; If not set the results are qualitative rather than quantitative.&quot;</span>;
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="group__CommonFunctions.html#gab3b95945319d230e7acf62cff169017c">00378</a> <span class="keyword">const</span> std::string <a class="code" href="group__CommonFunctions.html#gab3b95945319d230e7acf62cff169017c" title="Description of the --resolution option used in many modules.">ResolutionOptionDesc</a> =
<a name="l00379"></a>00379   <span class="stringliteral">&quot;Size of the image pixel in microns. If not present, the program attempts to&quot;</span>
<a name="l00380"></a>00380   <span class="stringliteral">&quot; to calculate it from the image dpi.&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga5e3460d8e3eb92dd0ed0e19b21e183ce" title="The note added to many options.">NeedForQuant</a>;
<a name="l00381"></a>00381 
<a name="l00384"></a><a class="code" href="group__CommonFunctions.html#gaf35a6e67bb37a3f948d1f01bc7a0c80b">00384</a> <span class="keyword">const</span> std::string <a class="code" href="group__CommonFunctions.html#gaf35a6e67bb37a3f948d1f01bc7a0c80b">SeeAlsoList</a> =
<a name="l00385"></a>00385   <span class="stringliteral">&quot;ctas(1), ctas-bg(1), ctas-ct(1), ctas-ct-abs(1), ctas-ct-dei(1),&quot;</span>
<a name="l00386"></a>00386   <span class="stringliteral">&quot; ctas-ct-edei(1), ctas-ct-ipc(1),&quot;</span>
<a name="l00387"></a>00387   <span class="stringliteral">&quot; ctas-dei(1), ctas-edei(1), ctas-ipc(1), ctas-f2i(1), ctas-ff(1),&quot;</span>
<a name="l00388"></a>00388   <span class="stringliteral">&quot; ctas-sino(1), ctas-sino-abs(1), ctas-sino-dei(1), ctas-sino-ipc(1),&quot;</span>
<a name="l00389"></a>00389   <span class="stringliteral">&quot; ctas-ts(1), ctas-ct-line(1)&quot;</span>;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00398"></a><a class="code" href="structToUpper.html">00398</a> <span class="keyword">struct </span><a class="code" href="structToLower.html" title="() (char c) const { return tolower(c); } };">ToLower</a>{ <span class="keywordtype">char</span> operator() (<span class="keywordtype">char</span> c)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> tolower(c); } };
<a name="l00399"></a>00399 <span class="keyword">struct </span><a class="code" href="structToUpper.html">ToUpper</a>{ <span class="keywordtype">char</span> operator() (<span class="keywordtype">char</span> c)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> toupper(c); } };
<a name="l00401"></a>00401 
<a name="l00402"></a><a class="code" href="group__CommonFunctions.html#gafb844ea13cbc3a3596026448ace0a808">00402</a> <span class="keywordtype">string</span>
<a name="l00403"></a>00403 <a class="code" href="group__CommonFunctions.html#gafb844ea13cbc3a3596026448ace0a808" title="Convert string to upper case.">upper</a>(<span class="keywordtype">string</span> str){
<a name="l00404"></a>00404   transform (str.begin(), str.end(), str.begin(), <a class="code" href="structToUpper.html">ToUpper</a>());
<a name="l00405"></a>00405   <span class="keywordflow">return</span> str;
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="group__CommonFunctions.html#ga2f5c59584246fec7dff2208f6ec04fa9">00408</a> <span class="keywordtype">string</span>
<a name="l00409"></a>00409 <a class="code" href="group__CommonFunctions.html#ga2f5c59584246fec7dff2208f6ec04fa9" title="Convert string to lower case.">lower</a>(<span class="keywordtype">string</span> str){
<a name="l00410"></a>00410   transform (str.begin(), str.end(), str.begin(), <a class="code" href="structToLower.html" title="() (char c) const { return tolower(c); } };">ToLower</a>());
<a name="l00411"></a>00411   <span class="keywordflow">return</span> str;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c">00415</a> <span class="keywordtype">string</span>
<a name="l00416"></a>00416 <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> fmt, ...){
<a name="l00417"></a>00417   va_list ap;
<a name="l00418"></a>00418   va_start(ap, fmt);
<a name="l00419"></a>00419   <span class="keyword">const</span> <span class="keywordtype">int</span> MAXLINE = 4096;
<a name="l00420"></a>00420   <span class="keywordtype">char</span> buf[MAXLINE];
<a name="l00421"></a>00421   vsnprintf(buf, MAXLINE, fmt.c_str(), ap);
<a name="l00422"></a>00422   va_end(ap);
<a name="l00423"></a>00423   <span class="keywordflow">return</span> string(buf);
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 
<a name="l00440"></a>00440 <a class="code" href="classProgressBar.html#a72c9acca2624b5701f1326d990bb6187" title="Initializing constructor.">ProgressBar::ProgressBar</a>(<span class="keywordtype">bool</span> _showme, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; _message, <span class="keywordtype">int</span> _steps) :
<a name="l00441"></a>00441   showme(_showme), message(_message), steps(_steps) {
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="keywordflow">if</span> ( ! showme ) <span class="keywordflow">return</span>;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   step = 0;
<a name="l00446"></a>00446   waswidth = 0;
<a name="l00447"></a>00447   reservedChs = 0;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   cout &lt;&lt; <span class="stringliteral">&quot;Starting process&quot;</span>;
<a name="l00450"></a>00450   <span class="keywordflow">if</span> (steps) cout &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(steps) + <span class="stringliteral">&quot; steps)&quot;</span>;
<a name="l00451"></a>00451   cout &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; message &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00452"></a>00452   fflush(stdout);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="keywordtype">int</span> nums = <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(steps).length();
<a name="l00455"></a>00455   reservedChs = 14 + 2*nums;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   fmt = steps ?
<a name="l00458"></a>00458         <span class="stringliteral">&quot;%&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(nums) + <span class="stringliteral">&quot;i of &quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(steps) + <span class="stringliteral">&quot; [%s] %4s&quot;</span> :
<a name="l00459"></a>00459         string( <span class="stringliteral">&quot;progress: %i&quot;</span> );
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00467"></a><a class="code" href="classProgressBar.html#a8206a039bb2710736a2ef4ee849206c9">00467</a> <span class="keywordtype">void</span>
<a name="l00468"></a>00468 <a class="code" href="classProgressBar.html#a8206a039bb2710736a2ef4ee849206c9" title="Updates the progress bar.">ProgressBar::update</a>(<span class="keywordtype">int</span> curstep){
<a name="l00469"></a>00469 
<a name="l00470"></a>00470   <span class="keywordflow">if</span> ( !<a class="code" href="classProgressBar.html#ac68fc70a51d5ece6ed58c9d1eee894a0" title="Tells if the bar should be shown.">showme</a> || !<a class="code" href="classProgressBar.html#a5719f553f74549c2c70375a095857e7a" title="Symbols for the constant part of the PB.">reservedChs</a> ) <span class="keywordflow">return</span>; <span class="comment">// Uninitialized progress bar.</span>
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <span class="keywordtype">int</span> progln = <a class="code" href="classProgressBar.html#aad18499fd092b7082f48b3dbdb33d2b4" title="Returns current terminal width.">getwidth</a>() - <a class="code" href="classProgressBar.html#a5719f553f74549c2c70375a095857e7a" title="Symbols for the constant part of the PB.">reservedChs</a>;
<a name="l00473"></a>00473   <span class="keywordflow">if</span> ( progln &lt;= 3 )  <span class="keywordflow">return</span>; <span class="comment">// if we have a very narrow terminal</span>
<a name="l00474"></a>00474   <a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a> = curstep ? curstep+1 : <a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a> + 1;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="keywordflow">if</span> ( <a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a> &amp;&amp; <a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a> &gt;= <a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a> ) {
<a name="l00477"></a>00477         <a class="code" href="classProgressBar.html#acdd64fd71db1d6978b6e6e88b9d7c62b" title="Finalizes the progress bar.">done</a>();
<a name="l00478"></a>00478         <span class="keywordflow">return</span>;
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordtype">string</span> outS;
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (<a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a>) {
<a name="l00483"></a>00483     <span class="keywordtype">string</span> eqs = string(progln*<a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a>/<a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a>, <span class="charliteral">&#39;=&#39;</span>) + string(progln, <span class="charliteral">&#39; &#39;</span>) ;
<a name="l00484"></a>00484     eqs.erase(progln);
<a name="l00485"></a>00485     <span class="keywordtype">string</span> prc = <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(<span class="stringliteral">&quot;%5.1f%% &quot;</span>, (100.0*<a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a>)/<a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a>);
<a name="l00486"></a>00486     outS = <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(<a class="code" href="classProgressBar.html#a17e91afec3e36712d161118634acb9c2" title="Format string used to print the numbers.">fmt</a>, <a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a>, eqs.c_str(), prc.c_str() );
<a name="l00487"></a>00487   } <span class="keywordflow">else</span> {
<a name="l00488"></a>00488     outS = <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(<a class="code" href="classProgressBar.html#a17e91afec3e36712d161118634acb9c2" title="Format string used to print the numbers.">fmt</a>, <a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a>);
<a name="l00489"></a>00489   }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491   cout &lt;&lt; string(<a class="code" href="classProgressBar.html#a95c47a5a15f9fad58f92ce62ac4cc163" title="The width of the terminal in the previous step.">waswidth</a>+1, <span class="charliteral">&#39;\b&#39;</span>) &lt;&lt; outS;
<a name="l00492"></a>00492   fflush(stdout);
<a name="l00493"></a>00493   <a class="code" href="classProgressBar.html#a95c47a5a15f9fad58f92ce62ac4cc163" title="The width of the terminal in the previous step.">waswidth</a> = outS.length();
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="classProgressBar.html#acdd64fd71db1d6978b6e6e88b9d7c62b">00498</a> <span class="keywordtype">void</span>
<a name="l00499"></a>00499 <a class="code" href="classProgressBar.html#acdd64fd71db1d6978b6e6e88b9d7c62b" title="Finalizes the progress bar.">ProgressBar::done</a>(){
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   <span class="keywordflow">if</span> ( !<a class="code" href="classProgressBar.html#ac68fc70a51d5ece6ed58c9d1eee894a0" title="Tells if the bar should be shown.">showme</a> || ! <a class="code" href="classProgressBar.html#a5719f553f74549c2c70375a095857e7a" title="Symbols for the constant part of the PB.">reservedChs</a> ) <span class="keywordflow">return</span>;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keywordtype">int</span> progln = <a class="code" href="classProgressBar.html#aad18499fd092b7082f48b3dbdb33d2b4" title="Returns current terminal width.">getwidth</a>() - <a class="code" href="classProgressBar.html#a5719f553f74549c2c70375a095857e7a" title="Symbols for the constant part of the PB.">reservedChs</a>;
<a name="l00504"></a>00504   <span class="keywordflow">if</span> ( progln &lt; 0 )  progln = 0; <span class="comment">// if we have a very narrow terminal</span>
<a name="l00505"></a>00505   <span class="keywordtype">string</span> eqs(progln, <span class="charliteral">&#39;=&#39;</span>);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   cout &lt;&lt; string(<a class="code" href="classProgressBar.html#a95c47a5a15f9fad58f92ce62ac4cc163" title="The width of the terminal in the previous step.">waswidth</a>+1, <span class="charliteral">&#39;\r&#39;</span>) 
<a name="l00508"></a>00508            &lt;&lt; ( <a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a> ?
<a name="l00509"></a>00509                         <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(<a class="code" href="classProgressBar.html#a17e91afec3e36712d161118634acb9c2" title="Format string used to print the numbers.">fmt</a>, <a class="code" href="classProgressBar.html#ac8b6d8289e1c4183a9c1284da9f24f41" title="Total number of steps in the progress.">steps</a>, eqs.c_str(), <span class="stringliteral">&quot;DONE. &quot;</span>) :
<a name="l00510"></a>00510                         <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(<a class="code" href="classProgressBar.html#a17e91afec3e36712d161118634acb9c2" title="Format string used to print the numbers.">fmt</a>, <a class="code" href="classProgressBar.html#a306e360a98b4f0a88ce0e88e6a2fda2d" title="Current step.">step</a>) + <span class="stringliteral">&quot; steps. DONE.&quot;</span> )
<a name="l00511"></a>00511            &lt;&lt; endl 
<a name="l00512"></a>00512            &lt;&lt; <span class="stringliteral">&quot;Successfully finished &quot;</span> &lt;&lt; <a class="code" href="classProgressBar.html#a7fdd22154b95fafd723f087c7c2800f0" title="Description of the process.">message</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00513"></a>00513   fflush(stdout);
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <a class="code" href="classProgressBar.html#a5719f553f74549c2c70375a095857e7a" title="Symbols for the constant part of the PB.">reservedChs</a> = 0;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;windows.h&gt;</span>
<a name="l00522"></a>00522 <span class="preprocessor">#else</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span><span class="preprocessor">#  include&lt;termios.h&gt;</span>
<a name="l00524"></a>00524 <span class="preprocessor">#  include&lt;sys/ioctl.h&gt;</span>
<a name="l00525"></a>00525 <span class="preprocessor">#endif</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span>
<a name="l00527"></a><a class="code" href="classProgressBar.html#aad18499fd092b7082f48b3dbdb33d2b4">00527</a> <span class="keywordtype">int</span>
<a name="l00528"></a>00528 <a class="code" href="classProgressBar.html#aad18499fd092b7082f48b3dbdb33d2b4" title="Returns current terminal width.">ProgressBar::getwidth</a>(){
<a name="l00529"></a>00529 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00530"></a>00530 <span class="preprocessor"></span>  CONSOLE_SCREEN_BUFFER_INFO info;
<a name="l00531"></a>00531   HANDLE fd = GetStdHandle(STD_OUTPUT_HANDLE);
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (fd == INVALID_HANDLE_VALUE)
<a name="l00533"></a>00533     <span class="keywordflow">return</span> 0;
<a name="l00534"></a>00534   <span class="keywordflow">return</span> GetConsoleScreenBufferInfo (fd, &amp;info) ? info.dwSize.X - 1 : 0;
<a name="l00535"></a>00535   <span class="comment">//return (info.srWindow.Right - info.srWindow.Left + 1);</span>
<a name="l00536"></a>00536 <span class="preprocessor">#else</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span>  winsize size;
<a name="l00538"></a>00538   <span class="keywordflow">return</span> ( ioctl (STDOUT_FILENO, TIOCGWINSZ, &amp;size ) &lt; 0 ) ?  0 : size.ws_col - 1;
<a name="l00539"></a>00539 <span class="preprocessor">#endif</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>}
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00553"></a>00553 <span class="preprocessor"></span><span class="preprocessor">#  define STATIC_MAGICK</span>
<a name="l00554"></a>00554 <span class="preprocessor"></span><span class="preprocessor">#  define MAGICK_STATIC_LINK</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00556"></a>00556 <span class="preprocessor"></span><span class="preprocessor">#include&lt;Magick++.h&gt;</span>
<a name="l00557"></a>00557 <span class="preprocessor">#include&lt;FreeImage.h&gt;</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 
<a name="l00560"></a><a class="code" href="common_8cpp.html#af50fe4d3b1afbac12a77bf376c3d9f78">00560</a> <span class="keyword">static</span> <span class="keywordtype">bool</span>
<a name="l00561"></a>00561 <a class="code" href="common_8cpp.html#af50fe4d3b1afbac12a77bf376c3d9f78" title="true if ImageMagick has been initialized.">CtasMagickInited</a> = <span class="keyword">false</span>; 
<a name="l00562"></a>00562 
<a name="l00566"></a><a class="code" href="common_8cpp.html#a9651b9551f69a53bf268eba5e9ba7d14">00566</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00567"></a>00567 <a class="code" href="common_8cpp.html#a9651b9551f69a53bf268eba5e9ba7d14" title="initializes ImageMagick library">initMagick</a>(){
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 <span class="preprocessor">#ifdef MAGICKLIB_NAMESPACE</span>
<a name="l00570"></a>00570 <span class="preprocessor"></span>  <span class="keyword">using namespace </span>MagickLib;
<a name="l00571"></a>00571 <span class="preprocessor">#else</span>
<a name="l00572"></a>00572 <span class="preprocessor"></span>  <span class="keyword">using namespace </span>MagickCore;
<a name="l00573"></a>00573 <span class="preprocessor">#endif</span>
<a name="l00574"></a>00574 <span class="preprocessor"></span>
<a name="l00575"></a>00575   <span class="keywordflow">if</span> ( <a class="code" href="common_8cpp.html#af50fe4d3b1afbac12a77bf376c3d9f78" title="true if ImageMagick has been initialized.">CtasMagickInited</a> )
<a name="l00576"></a>00576     <span class="keywordflow">return</span>;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   MagickSizeType Msz = (numeric_limits&lt;MagickSizeType&gt;::max)();
<a name="l00579"></a>00579   SetMagickResourceLimit ( AreaResource , 10000 * 10000 * 4);
<a name="l00580"></a>00580   SetMagickResourceLimit ( FileResource , 1024 * 1024);
<a name="l00581"></a>00581   SetMagickResourceLimit ( DiskResource , Msz);
<a name="l00582"></a>00582   SetMagickResourceLimit ( MapResource , Msz);
<a name="l00583"></a>00583   SetMagickResourceLimit ( MemoryResource , Msz);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <a class="code" href="common_8cpp.html#af50fe4d3b1afbac12a77bf376c3d9f78" title="true if ImageMagick has been initialized.">CtasMagickInited</a> = <span class="keyword">true</span>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 
<a name="l00600"></a><a class="code" href="common_8cpp.html#a6b373a5c6e99492cd50f72460b6788f5">00600</a> <span class="keyword">static</span> FIBITMAP *
<a name="l00601"></a>00601 <a class="code" href="common_8cpp.html#a6b373a5c6e99492cd50f72460b6788f5">FImageLoader</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename) {
<a name="l00602"></a>00602 
<a name="l00603"></a>00603   FREE_IMAGE_FORMAT fif = FIF_UNKNOWN;
<a name="l00604"></a>00604   FIBITMAP *dib=0;
<a name="l00605"></a>00605   fif = FreeImage_GetFileType(filename.c_str(), 0);
<a name="l00606"></a>00606   <span class="keywordflow">if</span>(fif == FIF_UNKNOWN)
<a name="l00607"></a>00607     fif = FreeImage_GetFIFFromFilename(filename.c_str());
<a name="l00608"></a>00608   <span class="keywordflow">if</span>((fif != FIF_UNKNOWN) &amp;&amp; FreeImage_FIFSupportsReading(fif))
<a name="l00609"></a>00609     dib = FreeImage_Load(fif, filename.c_str(), 0);
<a name="l00610"></a>00610   
<a name="l00611"></a>00611   <span class="keywordflow">if</span>( ! dib )
<a name="l00612"></a>00612         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load image FI&quot;</span>, <span class="stringliteral">&quot;Could not load image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614   FREE_IMAGE_COLOR_TYPE tp = FreeImage_GetColorType(dib);
<a name="l00615"></a>00615   <span class="keywordflow">if</span> ( tp != FIC_MINISBLACK  &amp;&amp;  tp != FIC_MINISWHITE ) {
<a name="l00616"></a>00616     FreeImage_Unload(dib);
<a name="l00617"></a>00617         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load image FI&quot;</span>, <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename +
<a name="l00618"></a>00618                            <span class="stringliteral">&quot;\&quot; is not grayscale.&quot;</span>);
<a name="l00619"></a>00619   }
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   <span class="keywordflow">return</span> dib;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 
<a name="l00627"></a><a class="code" href="group__IO.html#ga8e86fe71ec349e7de8ae5dd380ab2cab">00627</a> <span class="keywordtype">float</span>
<a name="l00628"></a>00628 <a class="code" href="group__IO.html#ga8e86fe71ec349e7de8ae5dd380ab2cab" title="Pixel size of the image.">PixelSize</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename) {
<a name="l00629"></a>00629   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> defaultSize = 1.0;
<a name="l00630"></a>00630   Magick::Image imag;
<a name="l00631"></a>00631   <span class="keywordflow">try</span> { imag.ping(filename); }    <span class="keywordflow">catch</span> ( Magick::WarningCoder err ) {}
<a name="l00632"></a>00632   Magick::Geometry dens = imag.density();
<a name="l00633"></a>00633   <span class="keywordtype">float</span> res = (float) dens.width();
<a name="l00634"></a>00634   <span class="keywordflow">if</span> ( ! dens.isValid() || ! res ) {
<a name="l00635"></a>00635     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;pixel size&quot;</span>, <span class="stringliteral">&quot;The resolution of the image \&quot;&quot;</span>+ filename+ <span class="stringliteral">&quot;\&quot;&quot;</span> <span class="stringliteral">&quot;is invalid.&quot;</span>);
<a name="l00636"></a>00636     <span class="keywordflow">return</span> defaultSize;
<a name="l00637"></a>00637   }
<a name="l00638"></a>00638   <span class="keywordflow">if</span> ( res != dens.height() )
<a name="l00639"></a>00639     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;pixel size&quot;</span>, <span class="stringliteral">&quot;The resolutions of the image \&quot;&quot;</span>+ filename+ <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00640"></a>00640          <span class="stringliteral">&quot;in vertical and horizontal directions differ.&quot;</span>);
<a name="l00641"></a>00641 
<a name="l00642"></a>00642   <span class="keywordflow">switch</span> ( imag.resolutionUnits() ) {
<a name="l00643"></a>00643   <span class="keywordflow">case</span> Magick::PixelsPerInchResolution : 
<a name="l00644"></a>00644     <span class="keywordflow">return</span> 25400.0f / res;
<a name="l00645"></a>00645   <span class="keywordflow">case</span> Magick::PixelsPerCentimeterResolution :
<a name="l00646"></a>00646     <span class="keywordflow">return</span> 10000.0f / res;
<a name="l00647"></a>00647   <span class="keywordflow">default</span>:
<a name="l00648"></a>00648     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;pixel size&quot;</span>, <span class="stringliteral">&quot;Undefined resolution units of the image \&quot;&quot;</span>+ filename+ <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l00649"></a>00649     <span class="keywordflow">return</span> defaultSize;
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 
<a name="l00654"></a><a class="code" href="group__IO.html#ga5ae888c778c04a7a8afa74e19ad636e2">00654</a> <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a>
<a name="l00655"></a>00655 <a class="code" href="group__IO.html#ga5ae888c778c04a7a8afa74e19ad636e2" title="Image sizes.">ImageSizes</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename){
<a name="l00656"></a>00656   Magick::Image imag;
<a name="l00657"></a>00657   <span class="keywordflow">try</span> { imag.ping(filename); }
<a name="l00658"></a>00658   <span class="keywordflow">catch</span> ( Magick::WarningCoder err ) {}
<a name="l00659"></a>00659   <span class="keywordflow">catch</span> ( Magick::Exception &amp; error) {
<a name="l00660"></a>00660     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;get image size&quot;</span>, <span class="stringliteral">&quot;Could not read image file\&quot;&quot;</span>+filename+<span class="stringliteral">&quot;\&quot;.&quot;</span>
<a name="l00661"></a>00661                         <span class="stringliteral">&quot; Caught Magick++ exception: \&quot;&quot;</span>+error.what()+<span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l00662"></a>00662   }
<a name="l00663"></a>00663   <span class="keywordflow">return</span> <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a>( imag.rows(), imag.columns() );
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="group__IO.html#ga7a0fd640fb3c44bdd8f1b86a644d5f33">00667</a> <span class="keywordtype">void</span>
<a name="l00668"></a>00668 <a class="code" href="group__IO.html#ga5ae888c778c04a7a8afa74e19ad636e2" title="Image sizes.">ImageSizes</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *hight){
<a name="l00669"></a>00669   <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a> shp = <a class="code" href="group__IO.html#ga5ae888c778c04a7a8afa74e19ad636e2" title="Image sizes.">ImageSizes</a>(filename);
<a name="l00670"></a>00670   *width = shp(1);
<a name="l00671"></a>00671   *hight = shp(0);
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00675"></a><a class="code" href="group__IO.html#gaa67e9a34c63f309de5eeb303063ee230">00675</a> <span class="keywordtype">void</span>
<a name="l00676"></a>00676 <a class="code" href="group__IO.html#gaa67e9a34c63f309de5eeb303063ee230" title="Check the shape of the image.">BadShape</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a> &amp; shp){
<a name="l00677"></a>00677   <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a> ashp = <a class="code" href="group__IO.html#ga5ae888c778c04a7a8afa74e19ad636e2" title="Image sizes.">ImageSizes</a>(filename);
<a name="l00678"></a>00678   <span class="keywordflow">if</span> ( ashp != shp )
<a name="l00679"></a>00679         <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;load image&quot;</span>, <span class="stringliteral">&quot;The shape of the image&quot;</span>
<a name="l00680"></a>00680                                 <span class="stringliteral">&quot;\&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;  (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(ashp) + <span class="stringliteral">&quot;) is not equal&quot;</span>
<a name="l00681"></a>00681                                 <span class="stringliteral">&quot; to the requested shape (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(shp)  + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 <span class="preprocessor">#  include&lt;climits&gt;</span>
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 
<a name="l00694"></a><a class="code" href="common_8cpp.html#aabbf0512d55472beec655d28b60d27f5">00694</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> StClass&gt; <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00695"></a>00695 <a class="code" href="common_8cpp.html#aabbf0512d55472beec655d28b60d27f5">fip2arr</a>(<a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage, FIBITMAP *dib ){
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <span class="keyword">const</span> <span class="keywordtype">double</span> coeff = numeric_limits&lt;StClass&gt;::is_integer ?
<a name="l00698"></a>00698         1.0/(numeric_limits&lt;StClass&gt;::max)()  :  1.0 ;
<a name="l00699"></a>00699   StClass * pixels = (StClass *)  FreeImage_GetBits(dib);
<a name="l00700"></a>00700   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l00701"></a>00701         bps = FreeImage_GetBPP(dib),
<a name="l00702"></a>00702         hight =  FreeImage_GetHeight(dib),
<a name="l00703"></a>00703         width =  FreeImage_GetWidth(dib),
<a name="l00704"></a>00704         shift =  FreeImage_GetPitch(dib) / (bps/8);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706   storage.resize(hight,width);
<a name="l00707"></a>00707   blitz::Array&lt;StClass,2&gt; tarr(hight,width);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0 ; y &lt; hight ; y++)
<a name="l00710"></a>00710         memcpy(tarr.data() + y*width, pixels + (hight-y-1)*shift, width*bps/8);
<a name="l00711"></a>00711   storage = blitz::cast&lt;float&gt;(tarr) * coeff;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 }
<a name="l00714"></a>00714 
<a name="l00720"></a><a class="code" href="common_8cpp.html#a9c10ce3e389293607f9c7c1c0fd12ae5">00720</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00721"></a>00721 <a class="code" href="common_8cpp.html#a9c10ce3e389293607f9c7c1c0fd12ae5">ReadImage_FI</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage ){
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   FIBITMAP *dib = <a class="code" href="common_8cpp.html#a6b373a5c6e99492cd50f72460b6788f5">FImageLoader</a>(filename);
<a name="l00724"></a>00724   <span class="keywordflow">if</span> (!dib)
<a name="l00725"></a>00725           <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load image FI&quot;</span>, <span class="stringliteral">&quot;FreeImage could not open image&quot;</span>
<a name="l00726"></a>00726                      <span class="stringliteral">&quot; \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; for reading.&quot;</span>);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   void (*convert)(<a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp;, FIBITMAP *);
<a name="l00729"></a>00729   <span class="keywordflow">switch</span> (  FreeImage_GetImageType(dib) ) {
<a name="l00730"></a>00730   <span class="keywordflow">case</span> FIT_UINT16 : convert = fip2arr&lt;unsigned short&gt;; <span class="keywordflow">break</span>;
<a name="l00731"></a>00731   <span class="keywordflow">case</span> FIT_INT16  : convert = fip2arr&lt;short&gt;;          <span class="keywordflow">break</span>;
<a name="l00732"></a>00732   <span class="keywordflow">case</span> FIT_UINT32 : convert = fip2arr&lt;unsigned&gt;;       <span class="keywordflow">break</span>;
<a name="l00733"></a>00733   <span class="keywordflow">case</span> FIT_INT32  : convert = fip2arr&lt;int&gt;;            <span class="keywordflow">break</span>;
<a name="l00734"></a>00734   <span class="keywordflow">case</span> FIT_FLOAT  : convert = fip2arr&lt;float&gt;;          <span class="keywordflow">break</span>;
<a name="l00735"></a>00735   <span class="keywordflow">case</span> FIT_DOUBLE :
<a name="l00736"></a>00736         <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load image FI&quot;</span>,
<a name="l00737"></a>00737                  <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; has pixels of double type.&quot;</span>
<a name="l00738"></a>00738                  <span class="stringliteral">&quot; May give wrong result when converting from double to float.&quot;</span>);
<a name="l00739"></a>00739         convert = fip2arr&lt;double&gt;;
<a name="l00740"></a>00740         <span class="keywordflow">break</span>;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   <span class="keywordflow">default</span> :
<a name="l00743"></a>00743     FreeImage_Unload(dib);
<a name="l00744"></a>00744         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load image FI&quot;</span>, <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00745"></a>00745                            <span class="stringliteral">&quot; cannot be loaded with FreeImage: not single channel per pixel.&quot;</span>);
<a name="l00746"></a>00746   }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748   convert(storage, dib);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750   FreeImage_Unload(dib);
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00759"></a><a class="code" href="common_8cpp.html#a07f361bdf2fb022f2957c761546a820d">00759</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00760"></a>00760 <a class="code" href="common_8cpp.html#a07f361bdf2fb022f2957c761546a820d">ReadImage_IM</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage ){
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   <a class="code" href="common_8cpp.html#a9651b9551f69a53bf268eba5e9ba7d14" title="initializes ImageMagick library">initMagick</a>();
<a name="l00763"></a>00763 
<a name="l00764"></a>00764   Magick::Image imag;
<a name="l00765"></a>00765   <span class="keywordflow">try</span> { imag.read(filename); }
<a name="l00766"></a>00766   <span class="keywordflow">catch</span> ( Magick::WarningCoder err ) {}
<a name="l00767"></a>00767   <span class="keywordflow">catch</span> ( Magick::Exception &amp; error) {
<a name="l00768"></a>00768     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;load image IM&quot;</span>, <span class="stringliteral">&quot;Could not read image file\&quot;&quot;</span>+filename+<span class="stringliteral">&quot;\&quot;.&quot;</span>
<a name="l00769"></a>00769                         <span class="stringliteral">&quot; Caught Magick++ exception: \&quot;&quot;</span>+error.what()+<span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l00770"></a>00770   }
<a name="l00771"></a>00771   <span class="keywordflow">if</span> ( imag.type() != Magick::GrayscaleType )
<a name="l00772"></a>00772     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load image IM&quot;</span>,
<a name="l00773"></a>00773                  <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; is not grayscale.&quot;</span>);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l00776"></a>00776     width = imag.columns(),
<a name="l00777"></a>00777     hight = imag.rows();
<a name="l00778"></a>00778   <span class="keyword">const</span> Magick::PixelPacket 
<a name="l00779"></a>00779     * pixels = imag.getConstPixels(0,0,width,hight);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781   storage.resize( hight, width );
<a name="l00782"></a>00782   <span class="keywordtype">float</span> * data = storage.data();
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0 ; k &lt; hight*width ; k++ )
<a name="l00785"></a>00785     *data++ = (<span class="keywordtype">float</span>) Magick::ColorGray( *pixels++  ) .shade();
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 
<a name="l00790"></a><a class="code" href="group__IO.html#gae0c550c8fca773f133499e990ebe70b6">00790</a> <span class="keywordtype">void</span>
<a name="l00791"></a>00791 <a class="code" href="group__IO.html#gae0c550c8fca773f133499e990ebe70b6" title="Load image from preopened object.">ReadImage</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage ){
<a name="l00792"></a>00792   <span class="keywordflow">try</span> { <a class="code" href="common_8cpp.html#a9c10ce3e389293607f9c7c1c0fd12ae5">ReadImage_FI</a>(filename, storage); }
<a name="l00793"></a>00793   <span class="keywordflow">catch</span> (<a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err) {
<a name="l00794"></a>00794         <span class="keywordflow">if</span> (err.<a class="code" href="classCtasErr.html#a29e66cdf8ef4dfe224ee287c6cf72d13" title="Returns error type.">type</a>() != <a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a79e18c2e2af3c0b01de4d1b303877697" title="Warning.">CtasErr::WARN</a>) <span class="keywordflow">throw</span> err;
<a name="l00795"></a>00795         <span class="comment">// warn(&quot;load image&quot;, &quot;Loading of image file \&quot;&quot; + filename + &quot;\&quot;&quot;</span>
<a name="l00796"></a>00796         <span class="comment">// &quot; with FreeImage failed. Trying to load using ImageMagick.&quot;);</span>
<a name="l00797"></a>00797         <a class="code" href="common_8cpp.html#a07f361bdf2fb022f2957c761546a820d">ReadImage_IM</a>(filename, storage);
<a name="l00798"></a>00798   }
<a name="l00799"></a>00799 }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 
<a name="l00802"></a><a class="code" href="group__IO.html#ga90ec574d8eb47c429f7c9f0aeb84278e">00802</a> <span class="keywordtype">void</span>
<a name="l00803"></a>00803 <a class="code" href="group__IO.html#gae0c550c8fca773f133499e990ebe70b6" title="Load image from preopened object.">ReadImage</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a> &amp; shp){
<a name="l00804"></a>00804   <a class="code" href="group__IO.html#gaa67e9a34c63f309de5eeb303063ee230" title="Check the shape of the image.">BadShape</a>(filename, shp);
<a name="l00805"></a>00805   <a class="code" href="group__IO.html#gae0c550c8fca773f133499e990ebe70b6" title="Load image from preopened object.">ReadImage</a>(filename, storage);
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 
<a name="l00819"></a><a class="code" href="common_8cpp.html#a796ff81f03d071ccd114d8f3adfee3cd">00819</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> StClass&gt; <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00820"></a>00820 <a class="code" href="common_8cpp.html#a796ff81f03d071ccd114d8f3adfee3cd">fip2ln</a>(<a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp; storage, FIBITMAP *dib, <span class="keywordtype">int</span> idx){
<a name="l00821"></a>00821 
<a name="l00822"></a>00822   <span class="keyword">const</span> <span class="keywordtype">double</span> coeff = numeric_limits&lt;StClass&gt;::is_integer ?
<a name="l00823"></a>00823         1.0/(numeric_limits&lt;StClass&gt;::max)()  :  1.0 ;
<a name="l00824"></a>00824   StClass * pixels = (StClass *)  FreeImage_GetBits(dib);
<a name="l00825"></a>00825   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l00826"></a>00826         bps = FreeImage_GetBPP(dib),
<a name="l00827"></a>00827         hight =  FreeImage_GetHeight(dib),
<a name="l00828"></a>00828         width =  FreeImage_GetWidth(dib),
<a name="l00829"></a>00829         shift =  FreeImage_GetPitch(dib) / (bps/8);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831   storage.resize(width);
<a name="l00832"></a>00832   blitz::Array&lt;StClass,1&gt; tarr(width) ;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   memcpy(tarr.data(), pixels + (hight-idx-1)*shift, width*bps/8);
<a name="l00835"></a>00835   storage = blitz::cast&lt;float&gt;(tarr) * coeff;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 
<a name="l00846"></a><a class="code" href="common_8cpp.html#af18866a2cf00026ae8f5f4d8812183dd">00846</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00847"></a>00847 <a class="code" href="common_8cpp.html#af18866a2cf00026ae8f5f4d8812183dd" title="Reads one line of the image using FreeImage library.">ReadImageLine_FI</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp; storage, <span class="keywordtype">int</span> idx){
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   FIBITMAP *dib = <a class="code" href="common_8cpp.html#a6b373a5c6e99492cd50f72460b6788f5">FImageLoader</a>(filename);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l00852"></a>00852         hight =  FreeImage_GetHeight(dib),
<a name="l00853"></a>00853         width =  FreeImage_GetWidth(dib);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <span class="keywordflow">if</span> (idx &gt;= hight || idx &lt; 0 ) {
<a name="l00856"></a>00856     FreeImage_Unload(dib);
<a name="l00857"></a>00857     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;load imageline FI&quot;</span>,
<a name="l00858"></a>00858                 <span class="stringliteral">&quot;The index of the line to be read (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(idx) + <span class="stringliteral">&quot;)&quot;</span>
<a name="l00859"></a>00859                                 <span class="stringliteral">&quot; is outside the image boundaries (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(hight) + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862   storage.resize( width );
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   void (*convert)(<a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp;, FIBITMAP *dib, int);
<a name="l00865"></a>00865   <span class="keywordflow">switch</span> ( FreeImage_GetImageType(dib) ) {
<a name="l00866"></a>00866   <span class="keywordflow">case</span> FIT_UINT16 : convert = fip2ln&lt;unsigned short&gt;; <span class="keywordflow">break</span>;
<a name="l00867"></a>00867   <span class="keywordflow">case</span> FIT_INT16  : convert = fip2ln&lt;short&gt;;          <span class="keywordflow">break</span>;
<a name="l00868"></a>00868   <span class="keywordflow">case</span> FIT_UINT32 : convert = fip2ln&lt;unsigned&gt;;       <span class="keywordflow">break</span>;
<a name="l00869"></a>00869   <span class="keywordflow">case</span> FIT_INT32  : convert = fip2ln&lt;int&gt;;            <span class="keywordflow">break</span>;
<a name="l00870"></a>00870   <span class="keywordflow">case</span> FIT_FLOAT  : convert = fip2ln&lt;float&gt;;          <span class="keywordflow">break</span>;
<a name="l00871"></a>00871   <span class="keywordflow">case</span> FIT_DOUBLE :
<a name="l00872"></a>00872         <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imageline FI&quot;</span>,
<a name="l00873"></a>00873                  <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; has pixels of double type.&quot;</span>
<a name="l00874"></a>00874                  <span class="stringliteral">&quot; May give wrong result when converting from double to float.&quot;</span>);
<a name="l00875"></a>00875         convert = fip2ln&lt;double&gt;;
<a name="l00876"></a>00876         <span class="keywordflow">break</span>;
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <span class="keywordflow">default</span> :
<a name="l00879"></a>00879     FreeImage_Unload(dib);
<a name="l00880"></a>00880         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imageline FI&quot;</span>, <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00881"></a>00881                            <span class="stringliteral">&quot; cannot be loaded with FreeImage: not single channel per pixel.&quot;</span>);
<a name="l00882"></a>00882   }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   convert(storage, dib, idx);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886   FreeImage_Unload(dib);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 
<a name="l00897"></a><a class="code" href="common_8cpp.html#a0c6112a49ef44b8c7ffa5cddc23bc20f">00897</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00898"></a>00898 <a class="code" href="common_8cpp.html#a0c6112a49ef44b8c7ffa5cddc23bc20f" title="Reads one line of the image using ImageMagick library.">ReadImageLine_IM</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp; storage, <span class="keywordtype">int</span> idx){
<a name="l00899"></a>00899 
<a name="l00900"></a>00900   <a class="code" href="common_8cpp.html#a9651b9551f69a53bf268eba5e9ba7d14" title="initializes ImageMagick library">initMagick</a>();
<a name="l00901"></a>00901   Magick::Image imag;
<a name="l00902"></a>00902   <span class="keywordflow">try</span> { imag.read(filename); } <span class="keywordflow">catch</span> ( Magick::WarningCoder err ) {}
<a name="l00903"></a>00903   <span class="keywordflow">if</span> ( imag.type() != Magick::GrayscaleType )
<a name="l00904"></a>00904     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imageline IM&quot;</span>,
<a name="l00905"></a>00905                  <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; is not grayscale.&quot;</span>);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   <span class="keyword">const</span> <span class="keywordtype">int</span> width = imag.columns();
<a name="l00908"></a>00908   <span class="keywordflow">if</span> ( idx &lt; 0 || (<span class="keywordtype">unsigned</span>) idx &gt;= imag.rows() )
<a name="l00909"></a>00909     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;load imageline IM&quot;</span>,
<a name="l00910"></a>00910                 <span class="stringliteral">&quot;The index of the line to be read (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(idx) + <span class="stringliteral">&quot;)&quot;</span>
<a name="l00911"></a>00911                                 <span class="stringliteral">&quot; is outside the image boundaries (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(imag.rows()) + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913   <span class="keyword">const</span> Magick::PixelPacket
<a name="l00914"></a>00914     * pixels = imag.getConstPixels(0,idx,width,1);
<a name="l00915"></a>00915   storage.resize( width );
<a name="l00916"></a>00916   <span class="keywordtype">float</span> * data = storage.data();
<a name="l00917"></a>00917 
<a name="l00918"></a>00918   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0 ; k &lt; width ; k++ )
<a name="l00919"></a>00919     *data++ = (<span class="keywordtype">float</span>) Magick::ColorGray( *pixels++  ) .shade();
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 
<a name="l00924"></a><a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08">00924</a> <span class="keywordtype">void</span>
<a name="l00925"></a>00925 <a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08" title="Load one line of the image.">ReadImageLine</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp; storage, <span class="keywordtype">int</span> idx){
<a name="l00926"></a>00926   <span class="keywordflow">try</span> { <a class="code" href="common_8cpp.html#af18866a2cf00026ae8f5f4d8812183dd" title="Reads one line of the image using FreeImage library.">ReadImageLine_FI</a>(filename, storage, idx); }
<a name="l00927"></a>00927   <span class="keywordflow">catch</span> (<a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err) {
<a name="l00928"></a>00928         <span class="keywordflow">if</span> (err.<a class="code" href="classCtasErr.html#a29e66cdf8ef4dfe224ee287c6cf72d13" title="Returns error type.">type</a>() != <a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a79e18c2e2af3c0b01de4d1b303877697" title="Warning.">CtasErr::WARN</a>)
<a name="l00929"></a>00929           <span class="keywordflow">throw</span> err;
<a name="l00930"></a>00930         <span class="comment">// Loading of image line from file \&quot;&quot; + filename + &quot;\&quot;</span>
<a name="l00931"></a>00931         <span class="comment">// with FreeImage failed. Trying to load using ImageMagick.</span>
<a name="l00932"></a>00932         <a class="code" href="common_8cpp.html#a0c6112a49ef44b8c7ffa5cddc23bc20f" title="Reads one line of the image using ImageMagick library.">ReadImageLine_IM</a>(filename, storage, idx);
<a name="l00933"></a>00933   }
<a name="l00934"></a>00934 }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936 
<a name="l00937"></a><a class="code" href="group__IO.html#ga01e36107c55681c281619701e500251b">00937</a> <span class="keywordtype">void</span>
<a name="l00938"></a>00938 <a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08" title="Load one line of the image.">ReadImageLine</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp; storage, <span class="keywordtype">int</span> idx,
<a name="l00939"></a>00939                           <span class="keyword">const</span> <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a> &amp; shp){
<a name="l00940"></a>00940   <a class="code" href="group__IO.html#gaa67e9a34c63f309de5eeb303063ee230" title="Check the shape of the image.">BadShape</a>(filename, shp);
<a name="l00941"></a>00941   <a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08" title="Load one line of the image.">ReadImageLine</a>(filename, storage, idx);
<a name="l00942"></a>00942 }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 
<a name="l00952"></a><a class="code" href="common_8cpp.html#a8925b86fecbb81659f1becd8880e4b48">00952</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00953"></a>00953 <a class="code" href="common_8cpp.html#af18866a2cf00026ae8f5f4d8812183dd" title="Reads one line of the image using FreeImage library.">ReadImageLine_FI</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage,
<a name="l00954"></a>00954                                   <span class="keyword">const</span> vector&lt;int&gt; &amp; idxs){
<a name="l00955"></a>00955 
<a name="l00956"></a>00956   FIBITMAP *dib = <a class="code" href="common_8cpp.html#a6b373a5c6e99492cd50f72460b6788f5">FImageLoader</a>(filename);
<a name="l00957"></a>00957   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l00958"></a>00958         hight =  FreeImage_GetHeight(dib),
<a name="l00959"></a>00959         width =  FreeImage_GetWidth(dib);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   storage.resize( idxs.size(), width );
<a name="l00962"></a>00962 
<a name="l00963"></a>00963   void (*convert)(<a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> &amp;, FIBITMAP *dib, int);
<a name="l00964"></a>00964   <span class="keywordflow">switch</span> ( FreeImage_GetImageType(dib) ) {
<a name="l00965"></a>00965   <span class="keywordflow">case</span> FIT_UINT16 : convert = fip2ln&lt;unsigned short&gt;; <span class="keywordflow">break</span>;
<a name="l00966"></a>00966   <span class="keywordflow">case</span> FIT_INT16  : convert = fip2ln&lt;short&gt;;          <span class="keywordflow">break</span>;
<a name="l00967"></a>00967   <span class="keywordflow">case</span> FIT_UINT32 : convert = fip2ln&lt;unsigned&gt;;       <span class="keywordflow">break</span>;
<a name="l00968"></a>00968   <span class="keywordflow">case</span> FIT_INT32  : convert = fip2ln&lt;int&gt;;            <span class="keywordflow">break</span>;
<a name="l00969"></a>00969   <span class="keywordflow">case</span> FIT_FLOAT  : convert = fip2ln&lt;float&gt;;          <span class="keywordflow">break</span>;
<a name="l00970"></a>00970   <span class="keywordflow">case</span> FIT_DOUBLE :
<a name="l00971"></a>00971         <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imagelines FI&quot;</span>,
<a name="l00972"></a>00972                  <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; has pixels of double type.&quot;</span>
<a name="l00973"></a>00973                  <span class="stringliteral">&quot; May give wrong result when converting from double to float.&quot;</span>);
<a name="l00974"></a>00974         convert = fip2ln&lt;double&gt;;
<a name="l00975"></a>00975         <span class="keywordflow">break</span>;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977   <span class="keywordflow">default</span> :
<a name="l00978"></a>00978     FreeImage_Unload(dib);
<a name="l00979"></a>00979         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imagelines FI&quot;</span>, <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00980"></a>00980                            <span class="stringliteral">&quot; cannot be loaded with FreeImage: not single channel per pixel.&quot;</span>);
<a name="l00981"></a>00981   }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> curel = 0 ; curel &lt; idxs.size() ; curel++ ){
<a name="l00984"></a>00984         <span class="keywordtype">int</span> cursl = idxs[curel];
<a name="l00985"></a>00985         <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> curline = storage(curel, blitz::Range::all());
<a name="l00986"></a>00986         <span class="keywordflow">if</span> ( cursl &gt;= hight || cursl &lt; 0 ) {
<a name="l00987"></a>00987           <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imagelines FI&quot;</span>,
<a name="l00988"></a>00988                    <span class="stringliteral">&quot;The index of the line to be read (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(cursl) + <span class="stringliteral">&quot;)&quot;</span>
<a name="l00989"></a>00989                    <span class="stringliteral">&quot; is outside the image boundaries (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(hight) + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00990"></a>00990           curline = 0.0;
<a name="l00991"></a>00991         } <span class="keywordflow">else</span> {
<a name="l00992"></a>00992           convert( curline, dib, cursl);
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995   }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997   FreeImage_Unload(dib);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 }
<a name="l01000"></a>01000 
<a name="l01007"></a><a class="code" href="common_8cpp.html#a1d75290b61c1ac6073c027f98156652a">01007</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01008"></a>01008 <a class="code" href="common_8cpp.html#a0c6112a49ef44b8c7ffa5cddc23bc20f" title="Reads one line of the image using ImageMagick library.">ReadImageLine_IM</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage,
<a name="l01009"></a>01009                            <span class="keyword">const</span> vector&lt;int&gt; &amp; idxs){
<a name="l01010"></a>01010 
<a name="l01011"></a>01011   <a class="code" href="common_8cpp.html#a9651b9551f69a53bf268eba5e9ba7d14" title="initializes ImageMagick library">initMagick</a>();
<a name="l01012"></a>01012   Magick::Image imag;
<a name="l01013"></a>01013   <span class="keywordflow">try</span> { imag.read(filename); } <span class="keywordflow">catch</span> ( Magick::WarningCoder err ) {}
<a name="l01014"></a>01014   <span class="keywordflow">if</span> ( imag.type() != Magick::GrayscaleType )
<a name="l01015"></a>01015     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imagelines IM&quot;</span>,
<a name="l01016"></a>01016                  <span class="stringliteral">&quot;Input image \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; is not grayscale.&quot;</span>);
<a name="l01017"></a>01017 
<a name="l01018"></a>01018   <span class="keyword">const</span> <span class="keywordtype">int</span> width = imag.columns();
<a name="l01019"></a>01019   <span class="keyword">const</span> <span class="keywordtype">int</span> hight = imag.rows();
<a name="l01020"></a>01020   storage.resize( idxs.size(), width );
<a name="l01021"></a>01021 
<a name="l01022"></a>01022   <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> curel = 0 ; curel &lt; idxs.size() ; curel++ ){
<a name="l01023"></a>01023         <span class="keywordtype">int</span> cursl = idxs[curel];
<a name="l01024"></a>01024         <span class="keywordflow">if</span> ( cursl &gt;= hight ) {
<a name="l01025"></a>01025           <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;load imagelines IM&quot;</span>,
<a name="l01026"></a>01026                    <span class="stringliteral">&quot;The index of the line to be read (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(cursl) + <span class="stringliteral">&quot;)&quot;</span>
<a name="l01027"></a>01027                    <span class="stringliteral">&quot; is outside the image boundaries (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(hight) + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l01028"></a>01028           storage(curel, blitz::Range::all() ) = 0.0;
<a name="l01029"></a>01029         } <span class="keywordflow">else</span> {
<a name="l01030"></a>01030           <span class="keyword">const</span> Magick::PixelPacket * pixels = imag.getConstPixels(0,cursl,width,1);
<a name="l01031"></a>01031           <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0 ; k &lt; width ; k++ )
<a name="l01032"></a>01032                 storage( (<span class="keywordtype">int</span>) curel, k) = (float) Magick::ColorGray( *pixels++  ) .shade();
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037 }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039 
<a name="l01040"></a>01040 
<a name="l01041"></a><a class="code" href="group__IO.html#gad641a5bc8bbcb5e32e89f6b7f3e500cf">01041</a> <span class="keywordtype">void</span>
<a name="l01042"></a>01042 <a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08" title="Load one line of the image.">ReadImageLine</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage,
<a name="l01043"></a>01043                            <span class="keyword">const</span> vector&lt;int&gt; &amp; idxs){
<a name="l01044"></a>01044   <span class="keywordflow">if</span> ( ! idxs.size() ) {
<a name="l01045"></a>01045     <a class="code" href="group__IO.html#gae0c550c8fca773f133499e990ebe70b6" title="Load image from preopened object.">ReadImage</a>(filename, storage);
<a name="l01046"></a>01046     <span class="keywordflow">return</span>;
<a name="l01047"></a>01047   }
<a name="l01048"></a>01048   <span class="keywordflow">try</span> { <a class="code" href="common_8cpp.html#af18866a2cf00026ae8f5f4d8812183dd" title="Reads one line of the image using FreeImage library.">ReadImageLine_FI</a>(filename, storage, idxs); }
<a name="l01049"></a>01049   <span class="keywordflow">catch</span> (<a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err) {
<a name="l01050"></a>01050         <span class="keywordflow">if</span> (err.<a class="code" href="classCtasErr.html#a29e66cdf8ef4dfe224ee287c6cf72d13" title="Returns error type.">type</a>() != <a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a79e18c2e2af3c0b01de4d1b303877697" title="Warning.">CtasErr::WARN</a>)
<a name="l01051"></a>01051           <span class="keywordflow">throw</span> err;
<a name="l01052"></a>01052         <span class="comment">/* warn(&quot;load image lines&quot;,</span>
<a name="l01053"></a>01053 <span class="comment">                 &quot;Loading of image lines from file \&quot;&quot; + filename + &quot;\&quot;&quot;</span>
<a name="l01054"></a>01054 <span class="comment">                 &quot; with FreeImage failed. Trying to load using ImageMagick.&quot;); */</span>
<a name="l01055"></a>01055         <a class="code" href="common_8cpp.html#a0c6112a49ef44b8c7ffa5cddc23bc20f" title="Reads one line of the image using ImageMagick library.">ReadImageLine_IM</a>(filename, storage, idxs);
<a name="l01056"></a>01056   }
<a name="l01057"></a>01057 }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 
<a name="l01060"></a>01060 
<a name="l01061"></a><a class="code" href="group__IO.html#ga7a36a289f1fc8b8cede62888cc27a962">01061</a> <span class="keywordtype">void</span>
<a name="l01062"></a>01062 <a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08" title="Load one line of the image.">ReadImageLine</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage,
<a name="l01063"></a>01063                           <span class="keyword">const</span> vector&lt;int&gt; &amp; idxs, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga777964671cb4315ce8c56c920db031e3" title="Shape of an 2D array.">Shape</a> &amp; shp){
<a name="l01064"></a>01064   <a class="code" href="group__IO.html#gaa67e9a34c63f309de5eeb303063ee230" title="Check the shape of the image.">BadShape</a>(filename, shp);
<a name="l01065"></a>01065   <a class="code" href="group__IO.html#ga5703869a92557ac281a47e5e39a82a08" title="Load one line of the image.">ReadImageLine</a>(filename, storage, idxs);
<a name="l01066"></a>01066 }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 
<a name="l01069"></a>01069 
<a name="l01070"></a>01070 
<a name="l01071"></a>01071 
<a name="l01072"></a>01072 
<a name="l01078"></a><a class="code" href="common_8cpp.html#a2401e8ef10e2ec067cd29ed6be7ebf6d">01078</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01079"></a>01079 <a class="code" href="common_8cpp.html#a2401e8ef10e2ec067cd29ed6be7ebf6d">SaveImageINT_FI</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage){
<a name="l01080"></a>01080 
<a name="l01081"></a>01081   FREE_IMAGE_FORMAT fif = FreeImage_GetFIFFromFilename(filename.c_str());
<a name="l01082"></a>01082   <span class="keywordflow">if</span>( fif == FIF_UNKNOWN )
<a name="l01083"></a>01083         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image FI&quot;</span>, <span class="stringliteral">&quot;The output filename \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l01084"></a>01084                            <span class="stringliteral">&quot; does not correspond to any format supported by FreeImage&quot;</span>);
<a name="l01085"></a>01085   <span class="keywordflow">if</span> ( ! FreeImage_FIFSupportsWriting(fif) )
<a name="l01086"></a>01086         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image FI&quot;</span>, <span class="stringliteral">&quot;FreeImage cannot write to this file format.&quot;</span>);
<a name="l01087"></a>01087 
<a name="l01088"></a>01088   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l01089"></a>01089     width = storage.columns(),
<a name="l01090"></a>01090     hight = storage.rows(),
<a name="l01091"></a>01091         bps = 16;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093   FIBITMAP *dib =  FreeImage_AllocateT(FIT_UINT16, width, hight, bps, 0, 0, 0);
<a name="l01094"></a>01094   <span class="keywordflow">if</span> (!dib)
<a name="l01095"></a>01095     <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image FI&quot;</span>, <span class="stringliteral">&quot;FreeImage could not allocate memory for the image.&quot;</span>);
<a name="l01096"></a>01096 
<a name="l01097"></a>01097   <span class="keyword">const</span> <span class="keywordtype">int</span> shift = FreeImage_GetPitch(dib) / (bps/8);
<a name="l01098"></a>01098   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> * pixels = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *) FreeImage_GetBits(dib);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   blitz::Array&lt;unsigned short,2&gt; tarr( storage.shape() ) ;
<a name="l01101"></a>01101   tarr = (numeric_limits&lt;unsigned short&gt;::max)() * storage;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0 ; y &lt; hight ; y++)
<a name="l01104"></a>01104         memcpy( pixels + (hight-y-1)*shift, tarr.data()+ y*width, width*bps/8);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <span class="keywordtype">bool</span> saveSuc = FreeImage_Save(fif, dib, filename.c_str(), 0);
<a name="l01107"></a>01107   FreeImage_Unload(dib);
<a name="l01108"></a>01108   <span class="keywordflow">if</span> ( ! saveSuc )
<a name="l01109"></a>01109         <span class="keywordflow">throw</span> <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image FI&quot;</span>, <span class="stringliteral">&quot;FreeImage could not save image&quot;</span>
<a name="l01110"></a>01110                            <span class="stringliteral">&quot; to output file \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l01111"></a>01111 
<a name="l01112"></a>01112 }
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 
<a name="l01120"></a><a class="code" href="common_8cpp.html#abee2969d2cd661ee0f014952dd9f99ea">01120</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01121"></a>01121 <a class="code" href="common_8cpp.html#abee2969d2cd661ee0f014952dd9f99ea">SaveImageINT_IM</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage){
<a name="l01122"></a>01122 
<a name="l01123"></a>01123   <a class="code" href="common_8cpp.html#a9651b9551f69a53bf268eba5e9ba7d14" title="initializes ImageMagick library">initMagick</a>();
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l01126"></a>01126     width = storage.columns(),
<a name="l01127"></a>01127     hight = storage.rows();
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   Magick::Image imag( Magick::Geometry(width, hight), <span class="stringliteral">&quot;black&quot;</span> );
<a name="l01130"></a>01130   imag.classType(Magick::DirectClass);
<a name="l01131"></a>01131   imag.type( Magick::GrayscaleType );
<a name="l01132"></a>01132   imag.depth(16);
<a name="l01133"></a>01133   imag.magick(<span class="stringliteral">&quot;TIFF&quot;</span>); <span class="comment">// saves to tif if not overwritten by the extension.</span>
<a name="l01134"></a>01134 
<a name="l01135"></a>01135   <span class="keyword">const</span> <span class="keywordtype">float</span> *data = storage.data();
<a name="l01136"></a>01136   Magick::PixelPacket * pixels = imag.getPixels(0,0,width,hight);
<a name="l01137"></a>01137   Magick::ColorGray colg;
<a name="l01138"></a>01138   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0 ; k &lt; hight*width ; k++ )
<a name="l01139"></a>01139     *pixels++ = Magick::PixelPacket( ( colg.shade( *data++ ), colg ) );
<a name="l01140"></a>01140 
<a name="l01141"></a>01141   imag.syncPixels();
<a name="l01142"></a>01142   <span class="keywordflow">try</span> { imag.write(filename); }
<a name="l01143"></a>01143   <span class="keywordflow">catch</span> ( Magick::Exception &amp; error) {
<a name="l01144"></a>01144     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;save image IM&quot;</span>, <span class="stringliteral">&quot;Could not write image file\&quot;&quot;</span>+filename+<span class="stringliteral">&quot;\&quot;.&quot;</span>
<a name="l01145"></a>01145                         <span class="stringliteral">&quot; Caught Magick++ exception: \&quot;&quot;</span>+error.what()+<span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l01146"></a>01146   }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 
<a name="l01152"></a>01152 
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 <span class="keyword">namespace </span>blitz {
<a name="l01155"></a>01155 
<a name="l01162"></a>01162 <span class="keywordtype">float</span>
<a name="l01163"></a>01163 limit01(<span class="keywordtype">float</span> x){
<a name="l01164"></a>01164   <span class="keywordflow">return</span> ( x &lt; 0.0 ) ? 
<a name="l01165"></a>01165     (0.0f) :
<a name="l01166"></a>01166     ( x &gt; 1.0 ? 1.0f : x ) ;
<a name="l01167"></a>01167 }
<a name="l01168"></a>01168 
<a name="l01170"></a>01170 BZ_DECLARE_FUNCTION(limit01);
<a name="l01172"></a>01172 
<a name="l01173"></a>01173 }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 
<a name="l01187"></a>01187 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01188"></a>01188 <a class="code" href="common_8cpp.html#a5dcd081a40acd1eff338f9c4a3b1f4e7" title="Save the array into integer image.">SaveImageINT</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage,
<a name="l01189"></a>01189                           <span class="keywordtype">float</span> minval=0, <span class="keywordtype">float</span> maxval=0 ){
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <span class="keywordflow">if</span> ( ! storage.size() ) {
<a name="l01192"></a>01192     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image&quot;</span>,
<a name="l01193"></a>01193                  <span class="stringliteral">&quot;Zero-sized array for image &#39;&quot;</span> + filename + <span class="stringliteral">&quot;&#39;: won&#39;t save.&quot;</span> );
<a name="l01194"></a>01194     <span class="keywordflow">return</span>;
<a name="l01195"></a>01195   }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197   <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> stor(storage.shape());
<a name="l01198"></a>01198   <span class="keywordflow">if</span> (minval == maxval) {
<a name="l01199"></a>01199           minval = (blitz::min)(storage);
<a name="l01200"></a>01200     maxval = (blitz::max)(storage);
<a name="l01201"></a>01201   }
<a name="l01202"></a>01202   <span class="keywordflow">if</span> (minval == maxval) {
<a name="l01203"></a>01203         <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image&quot;</span>,
<a name="l01204"></a>01204                  <span class="stringliteral">&quot;All elements in the image &#39;&quot;</span> + filename + <span class="stringliteral">&quot;&#39; have the same value.&quot;</span>);
<a name="l01205"></a>01205         <span class="keywordflow">if</span>      ( minval &lt; 0.0 ) stor = 0.0;
<a name="l01206"></a>01206         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( minval &gt; 1.0 ) stor = 1.0;
<a name="l01207"></a>01207         <span class="keywordflow">else</span>                     stor = minval;
<a name="l01208"></a>01208   } <span class="keywordflow">else</span> {
<a name="l01209"></a>01209         stor = ( storage - minval ) / (maxval-minval);
<a name="l01210"></a>01210         stor = limit01(stor);
<a name="l01211"></a>01211   }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213   <span class="keywordflow">try</span> { <a class="code" href="common_8cpp.html#a2401e8ef10e2ec067cd29ed6be7ebf6d">SaveImageINT_FI</a>(filename, stor); }
<a name="l01214"></a>01214   <span class="keywordflow">catch</span> (<a class="code" href="classCtasErr.html" title="Error type.">CtasErr</a> err) {
<a name="l01215"></a>01215         <span class="keywordflow">if</span> (err.<a class="code" href="classCtasErr.html#a29e66cdf8ef4dfe224ee287c6cf72d13" title="Returns error type.">type</a>() != <a class="code" href="classCtasErr.html#af961b70f6bb7cf20075131c79b049654a79e18c2e2af3c0b01de4d1b303877697" title="Warning.">CtasErr::WARN</a>)
<a name="l01216"></a>01216           <span class="keywordflow">throw</span> err;
<a name="l01217"></a>01217         <span class="comment">// Saving with FreeImage failed. Trying ImageMagick.</span>
<a name="l01218"></a>01218         <a class="code" href="common_8cpp.html#abee2969d2cd661ee0f014952dd9f99ea">SaveImageINT_IM</a>(filename, stor);
<a name="l01219"></a>01219   }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 
<a name="l01225"></a>01225 <span class="preprocessor">#  include &lt;tiffio.h&gt;</span>
<a name="l01226"></a>01226 <span class="preprocessor">#  include &lt;fcntl.h&gt;</span> <span class="comment">// for the libc &quot;open&quot; function see bug description in the SaveImageFP function.</span>
<a name="l01227"></a>01227 
<a name="l01236"></a>01236 <span class="keywordtype">void</span>
<a name="l01237"></a>01237 <a class="code" href="common_8cpp.html#afa4d600a6131fa61f7540324f912f831" title="Save the array into float point TIFF image.">SaveImageFP</a> (<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage){
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="keywordflow">if</span> ( ! storage.size() ) {
<a name="l01240"></a>01240     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;save image&quot;</span>, <span class="stringliteral">&quot;Zero-sized array for image.&quot;</span>);
<a name="l01241"></a>01241     <span class="keywordflow">return</span>;
<a name="l01242"></a>01242   }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244   <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l01245"></a>01245     width = storage.columns(),
<a name="l01246"></a>01246     hight = storage.rows();
<a name="l01247"></a>01247 
<a name="l01248"></a>01248     <span class="comment">// BUG in libtiff</span>
<a name="l01249"></a>01249   <span class="comment">// On platforms (f.e. CentOS) the TIFFOpen function fails,</span>
<a name="l01250"></a>01250   <span class="comment">// while TIFFFdOpen works well. On the MS Windows the</span>
<a name="l01251"></a>01251   <span class="comment">// TIFFFdOpen does not work, while TIFFOpen does.</span>
<a name="l01252"></a>01252 
<a name="l01253"></a>01253   <span class="keywordtype">int</span> fd=0;
<a name="l01254"></a>01254 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01255"></a>01255 <span class="preprocessor"></span>  TIFF *image = TIFFOpen(filename.c_str(), <span class="stringliteral">&quot;w&quot;</span>);
<a name="l01256"></a>01256 <span class="preprocessor">#else</span>
<a name="l01257"></a>01257 <span class="preprocessor"></span>  fd = open (filename.c_str(), O_RDWR | O_CREAT | O_TRUNC, 0666);
<a name="l01258"></a>01258   <span class="keywordflow">if</span> (fd &lt; 1)
<a name="l01259"></a>01259         <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;save float-point image&quot;</span>,
<a name="l01260"></a>01260                                 <span class="stringliteral">&quot;Could not open file \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; for writing.&quot;</span>);
<a name="l01261"></a>01261   TIFF *image = TIFFFdOpen(fd, filename.c_str(), <span class="stringliteral">&quot;w&quot;</span>);
<a name="l01262"></a>01262 <span class="preprocessor">#endif</span>
<a name="l01263"></a>01263 <span class="preprocessor"></span>
<a name="l01264"></a>01264   <span class="keywordflow">if</span>( ! image ) {
<a name="l01265"></a>01265         <span class="keywordflow">if</span> (fd) close(fd);
<a name="l01266"></a>01266         <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;save float-point image&quot;</span>,
<a name="l01267"></a>01267                                 <span class="stringliteral">&quot;Could create tif from file\&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l01268"></a>01268   }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270   <span class="comment">// We need to set some values for basic tags before we can add any data</span>
<a name="l01271"></a>01271   TIFFSetField(image, TIFFTAG_IMAGEWIDTH, width);
<a name="l01272"></a>01272   TIFFSetField(image, TIFFTAG_IMAGELENGTH, hight);
<a name="l01273"></a>01273   TIFFSetField(image, TIFFTAG_BITSPERSAMPLE, 32);
<a name="l01274"></a>01274   TIFFSetField(image, TIFFTAG_SAMPLESPERPIXEL, 1);
<a name="l01275"></a>01275   TIFFSetField(image, TIFFTAG_ROWSPERSTRIP, hight);
<a name="l01276"></a>01276   TIFFSetField(image, TIFFTAG_SAMPLEFORMAT,SAMPLEFORMAT_IEEEFP);
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <span class="keywordtype">int</span> wret = TIFFWriteRawStrip(image, 0, (<span class="keywordtype">void</span>*) storage.data(), width*hight*4);
<a name="l01279"></a>01279   TIFFClose(image);
<a name="l01280"></a>01280   <span class="keywordflow">if</span> (fd) close(fd);
<a name="l01281"></a>01281   <span class="keywordflow">if</span> ( -1 == wret )
<a name="l01282"></a>01282         <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;save 32-bit image&quot;</span>,
<a name="l01283"></a>01283                                 <span class="stringliteral">&quot;Could not save image to file \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;.&quot;</span>); 
<a name="l01284"></a>01284 
<a name="l01285"></a>01285 }
<a name="l01286"></a>01286 
<a name="l01287"></a><a class="code" href="group__IO.html#gae45e74b44be3e797bcf1f2ae84d211ef">01287</a> 
<a name="l01288"></a>01288 <span class="keywordtype">void</span>
<a name="l01289"></a>01289 <a class="code" href="group__IO.html#gae45e74b44be3e797bcf1f2ae84d211ef" title="Save the array into image.">SaveImage</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage, <span class="keywordtype">bool</span> saveint){
<a name="l01290"></a>01290   <span class="keywordflow">if</span> (saveint) <a class="code" href="common_8cpp.html#a5dcd081a40acd1eff338f9c4a3b1f4e7" title="Save the array into integer image.">SaveImageINT</a>(filename, storage);
<a name="l01291"></a>01291   <span class="keywordflow">else</span> <a class="code" href="common_8cpp.html#afa4d600a6131fa61f7540324f912f831" title="Save the array into float point TIFF image.">SaveImageFP</a>(filename, storage);
<a name="l01292"></a>01292 }
<a name="l01293"></a><a class="code" href="group__IO.html#gada3965acc5403b0ac1816014b6d079c0">01293</a> 
<a name="l01294"></a>01294 <span class="keywordtype">void</span>
<a name="l01295"></a>01295 <a class="code" href="group__IO.html#gae45e74b44be3e797bcf1f2ae84d211ef" title="Save the array into image.">SaveImage</a>(<span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> &amp; filename, <span class="keyword">const</span> <a class="code" href="group__Types.html#ga8747378c016fc11d9ecbb98787248c25" title="2D Array with data.">Map</a> &amp; storage,
<a name="l01296"></a>01296           <span class="keywordtype">float</span> minval, <span class="keywordtype">float</span> maxval ){
<a name="l01297"></a>01297   <a class="code" href="common_8cpp.html#a5dcd081a40acd1eff338f9c4a3b1f4e7" title="Save the array into integer image.">SaveImageINT</a>(filename, storage, minval, maxval);
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300 
<a name="l01301"></a>01301 
<a name="l01302"></a>01302 
<a name="l01303"></a>01303 
<a name="l01304"></a>01304 
<a name="l01305"></a>01305 
<a name="l01306"></a>01306 
<a name="l01307"></a>01307 
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 
<a name="l01313"></a>01313 
<a name="l01314"></a><a class="code" href="group__IO.html#ga0f88c53b648824e6db8e2dc716d273f0">01314</a> 
<a name="l01315"></a>01315 <span class="keywordtype">void</span>
<a name="l01316"></a>01316 <a class="code" href="group__IO.html#ga0f88c53b648824e6db8e2dc716d273f0" title="Save any amount of lines into data file.">SaveData</a> ( <span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> filename, ... ) {
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   va_list ap;
<a name="l01319"></a>01319   va_start(ap, filename);
<a name="l01320"></a>01320 
<a name="l01321"></a>01321   vector&lt;const Line*&gt; storage;
<a name="l01322"></a>01322   <span class="keywordflow">while</span> ( <span class="keyword">const</span> <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> *curstor = va_arg(ap,<span class="keyword">const</span> <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a>*) )
<a name="l01323"></a>01323     storage.push_back(curstor);
<a name="l01324"></a>01324   va_end(ap);
<a name="l01325"></a>01325 
<a name="l01326"></a>01326   <span class="keywordtype">int</span> nof_args = storage.size();
<a name="l01327"></a>01327   <span class="keywordflow">if</span> ( ! nof_args ) {
<a name="l01328"></a>01328     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;write data&quot;</span>, <span class="stringliteral">&quot;No arrays provided for output. Nothing to do.&quot;</span> );
<a name="l01329"></a>01329     <span class="keywordflow">return</span>;
<a name="l01330"></a>01330   }
<a name="l01331"></a>01331 
<a name="l01332"></a>01332   <span class="keywordtype">int</span> size = storage.front()-&gt;size();
<a name="l01333"></a>01333   <span class="keywordflow">if</span> ( ! size ) {
<a name="l01334"></a>01334     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;write data&quot;</span>, <span class="stringliteral">&quot;Empty arrays provided for output. Nothing to do.&quot;</span> );
<a name="l01335"></a>01335     <span class="keywordflow">return</span>;
<a name="l01336"></a>01336   }
<a name="l01337"></a>01337   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> icur = 0 ; icur &lt; nof_args ; icur++)
<a name="l01338"></a>01338     <span class="keywordflow">if</span> ( storage[icur]-&gt;size() != size )
<a name="l01339"></a>01339       <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;write data&quot;</span>,
<a name="l01340"></a>01340                   <span class="stringliteral">&quot;The size of the array in the position &quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(icur) +
<a name="l01341"></a>01341                                   <span class="stringliteral">&quot; (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(storage[icur]-&gt;size()) + <span class="stringliteral">&quot;) does not match the&quot;</span>
<a name="l01342"></a>01342                                   <span class="stringliteral">&quot; size of the first array (&quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(size) + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l01343"></a>01343 
<a name="l01344"></a>01344   FILE *funcf = fopen( filename.c_str(), <span class="stringliteral">&quot;w&quot;</span> );
<a name="l01345"></a>01345   <span class="keywordflow">if</span> ( ! funcf )
<a name="l01346"></a>01346     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;write data&quot;</span>, <span class="stringliteral">&quot;Could not open output file \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l01347"></a>01347 
<a name="l01348"></a>01348   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> element = 0 ; element &lt; size ; element++) {
<a name="l01349"></a>01349     <span class="keywordtype">bool</span> printok = <span class="keyword">true</span>;
<a name="l01350"></a>01350     <span class="keywordtype">int</span> curarray = -1;
<a name="l01351"></a>01351     <span class="keywordflow">while</span> (printok &amp;&amp; ++curarray &lt; nof_args)
<a name="l01352"></a>01352       printok = fprintf( funcf, <span class="stringliteral">&quot;%G &quot;</span>, (*storage[curarray])(element) ) &gt;= 0;
<a name="l01353"></a>01353     <span class="keywordflow">if</span> ( ! printok ||
<a name="l01354"></a>01354                  fseek (funcf, -1, SEEK_CUR) || <span class="comment">// removes last space</span>
<a name="l01355"></a>01355                  fprintf(funcf, <span class="stringliteral">&quot;\n&quot;</span>) &lt; 0 ) {
<a name="l01356"></a>01356       fclose (funcf);
<a name="l01357"></a>01357       <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;write data&quot;</span>, <span class="stringliteral">&quot;Could not print into output file&quot;</span>
<a name="l01358"></a>01358                                   <span class="stringliteral">&quot; \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; in position &quot;</span> + <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(element) + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l01359"></a>01359     }
<a name="l01360"></a>01360   }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362   fclose (funcf);
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 }
<a name="l01365"></a>01365 
<a name="l01366"></a><a class="code" href="group__IO.html#ga02288ddbc5eb5144a7a92eb0a06ee1b6">01366</a> 
<a name="l01367"></a>01367 <span class="keywordtype">void</span>
<a name="l01368"></a>01368 <a class="code" href="group__IO.html#ga02288ddbc5eb5144a7a92eb0a06ee1b6" title="Loads any amount of lines from data file.">LoadData</a> ( <span class="keyword">const</span> <a class="code" href="classPath.html" title="Path in the directory structure.">Path</a> filename, ... ) {
<a name="l01369"></a>01369 
<a name="l01370"></a>01370   vector&lt;Line*&gt; storage;
<a name="l01371"></a>01371 
<a name="l01372"></a>01372   va_list ap;
<a name="l01373"></a>01373   va_start(ap, filename);
<a name="l01374"></a>01374   <span class="keywordflow">while</span> ( <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a> * curstor = va_arg(ap, <a class="code" href="group__Types.html#ga4ce3fdeba27702c8b09a141e22709e38" title="1D line with data.">Line</a>*) )
<a name="l01375"></a>01375     storage.push_back( curstor );
<a name="l01376"></a>01376   va_end(ap);
<a name="l01377"></a>01377 
<a name="l01378"></a>01378   <span class="keywordtype">int</span> nof_args = storage.size();
<a name="l01379"></a>01379   <span class="keywordflow">if</span> ( ! nof_args ) {
<a name="l01380"></a>01380     <a class="code" href="group__Error.html#gafc17a83d686f911fcbed38f9b4b4fda4" title="Constructs the warning and reports it.">warn</a>(<span class="stringliteral">&quot;read data&quot;</span>, <span class="stringliteral">&quot;No arrays provided for input. Nothing to do.&quot;</span> );
<a name="l01381"></a>01381     <span class="keywordflow">return</span>;
<a name="l01382"></a>01382   }
<a name="l01383"></a>01383   vector&lt; vector&lt;float&gt; &gt; data_read(nof_args);
<a name="l01384"></a>01384 
<a name="l01385"></a>01385   FILE *funcf = fopen( filename.c_str(), <span class="stringliteral">&quot;r&quot;</span> );
<a name="l01386"></a>01386   <span class="keywordflow">if</span> ( ! funcf )
<a name="l01387"></a>01387     <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;read data&quot;</span>, <span class="stringliteral">&quot;Could not open input file \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   <span class="keywordtype">bool</span> this_is_the_end = <span class="keyword">false</span>;
<a name="l01390"></a>01390   <span class="keywordflow">while</span> ( ! this_is_the_end ) {
<a name="l01391"></a>01391     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> curarray = 0 ; curarray &lt; nof_args ; curarray++ ) {
<a name="l01392"></a>01392       <span class="keywordtype">float</span> toread;
<a name="l01393"></a>01393       <span class="keywordflow">if</span> ( fscanf( funcf, <span class="stringliteral">&quot;%f &quot;</span>, &amp;toread ) != 1 ) {
<a name="l01394"></a>01394         fclose (funcf);
<a name="l01395"></a>01395         <a class="code" href="group__Error.html#gaad605c8e899cb915d214127c18a12157" title="Constructs the error, reports and then throws it.">throw_error</a>(<span class="stringliteral">&quot;read data&quot;</span>, <span class="stringliteral">&quot;Could not scan float from input file&quot;</span>
<a name="l01396"></a>01396                                         <span class="stringliteral">&quot; \&quot;&quot;</span> + filename + <span class="stringliteral">&quot;\&quot; at line &quot;</span> +
<a name="l01397"></a>01397                                         <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(data_read[curarray].size() + 1) + <span class="stringliteral">&quot;, position &quot;</span> +
<a name="l01398"></a>01398                                         <a class="code" href="group__CommonFunctions.html#ga0c99deaa2f9c487d645d3d6807fe899c" title="Prints formatted message to string.">toString</a>(curarray + 1) + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l01399"></a>01399       }
<a name="l01400"></a>01400       data_read[curarray].push_back(toread);
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402     this_is_the_end = fscanf(funcf, <span class="stringliteral">&quot;\n&quot;</span>) &lt; 0 || feof(funcf);
<a name="l01403"></a>01403   }
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   fclose (funcf);
<a name="l01406"></a>01406 
<a name="l01407"></a>01407   <span class="keywordtype">int</span> size = data_read[0].size();
<a name="l01408"></a>01408   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> curarray = 0 ; curarray &lt; nof_args ; curarray++ ) {
<a name="l01409"></a>01409     (*storage[curarray]).resize(size);
<a name="l01410"></a>01410     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> element = 0 ; element &lt; size ; element++)
<a name="l01411"></a>01411       (*storage[curarray])(element) = data_read[curarray][element];
<a name="l01412"></a>01412   }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 8 2011 16:05:59 for ctas by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
